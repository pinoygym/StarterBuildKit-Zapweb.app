bun : $ vitest run tests/unit
At line:1 char:1
+ bun run test:unit > unit_test_results.txt 2>&1
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: ($ vitest run tests/unit:String) [], RemoteException
    + FullyQualifiedErrorId : NativeCommandError
 

[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/cyber/Documents/GitHub/buenasv2[39m

[90mstdout[2m | tests/unit/services/supplier.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/auth.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/contexts/branch-context.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/customer.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/components/submit-button.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/product.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/contexts/auth-context.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/jwt-mock-test.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  suppress all logs with { quiet: true }
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/inventory-adjustments.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/lib/utils.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/components/purchase-order-form.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/jwt-mock-test.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 127[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/lib/utils.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 71[2mms[22m[39m
[90mstderr[2m | tests/unit/services/inventory-adjustments.service.test.ts[2m > [22m[2mInventoryAdjustmentService[2m > [22m[2mcreate[2m > 
[22m[2mshould create a draft adjustment successfully
[22m[39mAuditService.log error: TypeError: Cannot read properties of undefined (reading 'create')
    at AuditLogRepository.create (C:/Users/cyber/Documents/GitHub/buenasv2/repositories/audit-log.repository.ts:11:28)
    at AuditService.log (C:/Users/cyber/Documents/GitHub/buenasv2/services/audit.service.ts:75:39)
    at C:/Users/cyber/Documents/GitHub/buenasv2/services/inventory-adjustment.service.ts:95:32
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | tests/unit/services/inventory-adjustments.service.test.ts[2m > [22m[2mInventoryAdjustmentService[2m > [22m[2mupdate[2m > 
[22m[2mshould update a draft adjustment
[22m[39mAuditService.log error: TypeError: Cannot read properties of undefined (reading 'create')
    at AuditLogRepository.create (C:/Users/cyber/Documents/GitHub/buenasv2/repositories/audit-log.repository.ts:11:28)
    at AuditService.log (C:/Users/cyber/Documents/GitHub/buenasv2/services/audit.service.ts:75:39)
    at InventoryAdjustmentService.update (C:/Users/cyber/Documents/GitHub/buenasv2/services/inventory-adjustment.service.ts:185:28)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at C:/Users/cyber/Documents/GitHub/buenasv2/tests/unit/services/inventory-adjustments.service.test.ts:106:28
    at [90mfile:///C:/Users/cyber/Documents/GitHub/buenasv2/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:20

[90mstderr[2m | tests/unit/services/inventory-adjustments.service.test.ts[2m > [22m[2mInventoryAdjustmentService[2m > [22m[2mpost[2m > 
[22m[2mshould post an adjustment, update inventory records with system quantities, and update stock
[22m[39mAuditService.log error: TypeError: Cannot read properties of undefined (reading 'create')
    at AuditLogRepository.create (C:/Users/cyber/Documents/GitHub/buenasv2/repositories/audit-log.repository.ts:11:28)
    at AuditService.log (C:/Users/cyber/Documents/GitHub/buenasv2/services/audit.service.ts:75:39)
    at C:/Users/cyber/Documents/GitHub/buenasv2/services/inventory-adjustment.service.ts:309:32
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | tests/unit/services/inventory-adjustments.service.test.ts[2m > [22m[2mInventoryAdjustmentService[2m > [22m[2mcopy[2m > 
[22m[2mshould create a copy of an adjustment
[22m[39mAuditService.log error: TypeError: Cannot read properties of undefined (reading 'create')
    at AuditLogRepository.create (C:/Users/cyber/Documents/GitHub/buenasv2/repositories/audit-log.repository.ts:11:28)
    at AuditService.log (C:/Users/cyber/Documents/GitHub/buenasv2/services/audit.service.ts:75:39)
    at C:/Users/cyber/Documents/GitHub/buenasv2/services/inventory-adjustment.service.ts:95:32
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

 [31mΓ¥»[39m tests/unit/services/auth.service.test.ts [2m([22m[2m12 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 43[2mms[22m[39m
[31m       [31m├ù[31m should successfully register a new user[39m[32m 20[2mms[22m[39m
       [32mΓ£ô[39m should fail if email already exists[32m 2[2mms[22m[39m
       [32mΓ£ô[39m should throw error if default role not found[32m 3[2mms[22m[39m
       [32mΓ£ô[39m should successfully login with valid credentials[32m 4[2mms[22m[39m
       [32mΓ£ô[39m should fail if user not found[32m 1[2mms[22m[39m
       [32mΓ£ô[39m should fail if password is valid[32m 1[2mms[22m[39m
[31m       [31m├ù[31m should fail if user is inactive[39m[32m 5[2mms[22m[39m
       [32mΓ£ô[39m should fail if email is not verified[32m 0[2mms[22m[39m
       [32mΓ£ô[39m should delete session and log logout[32m 1[2mms[22m[39m
       [32mΓ£ô[39m should return session if valid[32m 1[2mms[22m[39m
       [32mΓ£ô[39m should return null if session expired[32m 1[2mms[22m[39m
       [32mΓ£ô[39m should return null if user is inactive[32m 0[2mms[22m[39m
[90mstderr[2m | tests/unit/services/inventory-adjustments.service.test.ts[2m > [22m[2mInventoryAdjustmentService[2m > [22m[2mcopy[2m > 
[22m[2mshould create a copy of an adjustment
[22m[39mAuditService.log error: TypeError: Cannot read properties of undefined (reading 'create')
    at AuditLogRepository.create (C:/Users/cyber/Documents/GitHub/buenasv2/repositories/audit-log.repository.ts:11:28)
    at AuditService.log (C:/Users/cyber/Documents/GitHub/buenasv2/services/audit.service.ts:75:39)
    at InventoryAdjustmentService.copy (C:/Users/cyber/Documents/GitHub/buenasv2/services/inventory-adjustment.service.ts:453:28)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at C:/Users/cyber/Documents/GitHub/buenasv2/tests/unit/services/inventory-adjustments.service.test.ts:257:13
    at [90mfile:///C:/Users/cyber/Documents/GitHub/buenasv2/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:20

[90mstderr[2m | tests/unit/services/inventory-adjustments.service.test.ts[2m > [22m[2mInventoryAdjustmentService[2m > [22m[2mreverse[2m > 
[22m[2mshould create a reversal adjustment and automatically post it
[22m[39mAuditService.log error: TypeError: Cannot read properties of undefined (reading 'create')
    at AuditLogRepository.create (C:/Users/cyber/Documents/GitHub/buenasv2/repositories/audit-log.repository.ts:11:28)
    at AuditService.log (C:/Users/cyber/Documents/GitHub/buenasv2/services/audit.service.ts:75:39)
    at C:/Users/cyber/Documents/GitHub/buenasv2/services/inventory-adjustment.service.ts:95:32
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | tests/unit/services/inventory-adjustments.service.test.ts[2m > [22m[2mInventoryAdjustmentService[2m > [22m[2mreverse[2m > 
[22m[2mshould create a reversal adjustment and automatically post it
[22m[39mAuditService.log error: TypeError: Cannot read properties of undefined (reading 'create')
    at AuditLogRepository.create (C:/Users/cyber/Documents/GitHub/buenasv2/repositories/audit-log.repository.ts:11:28)
    at AuditService.log (C:/Users/cyber/Documents/GitHub/buenasv2/services/audit.service.ts:75:39)
    at InventoryAdjustmentService.reverse (C:/Users/cyber/Documents/GitHub/buenasv2/services/inventory-adjustment.service.ts:509:28)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at C:/Users/cyber/Documents/GitHub/buenasv2/tests/unit/services/inventory-adjustments.service.test.ts:308:28
    at [90mfile:///C:/Users/cyber/Documents/GitHub/buenasv2/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:20

[90mstderr[2m | tests/unit/services/inventory-adjustments.service.test.ts[2m > [22m[2mInventoryAdjustmentService[2m > [22m[2mreverse[2m > 
[22m[2mshould create a reversal adjustment and automatically post it
[22m[39mAuditService.log error: TypeError: Cannot read properties of undefined (reading 'create')
    at AuditLogRepository.create (C:/Users/cyber/Documents/GitHub/buenasv2/repositories/audit-log.repository.ts:11:28)
    at AuditService.log (C:/Users/cyber/Documents/GitHub/buenasv2/services/audit.service.ts:75:39)
    at C:/Users/cyber/Documents/GitHub/buenasv2/services/inventory-adjustment.service.ts:309:32
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

 [32mΓ£ô[39m tests/unit/services/inventory-adjustments.service.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 57[2mms[22m[39m
[90mstdout[2m | tests/unit/services/product.service.test.ts
[22m[39m{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-19T02:38:42.201Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/unit/services/supplier.service.test.ts
[22m[39m{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-19T02:38:42.201Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/unit/services/customer.service.test.ts
[22m[39m{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-19T02:38:42.201Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/unit/services/supplier.service.test.ts[2m > [22m[2mSupplierService[2m > [22m[2mgetAllSuppliers[2m > [22m[2mshould return all suppliers
[22m[39m[SupplierService] getAllSuppliers called with filters: [90mundefined[39m

[90mstdout[2m | tests/unit/services/supplier.service.test.ts[2m > [22m[2mSupplierService[2m > [22m[2mgetAllSuppliers[2m > [22m[2mshould return all suppliers
[22m[39m[SupplierService] Found 2 suppliers

[90mstdout[2m | tests/unit/services/supplier.service.test.ts[2m > [22m[2mSupplierService[2m > [22m[2mgetAllSuppliers[2m > [22m[2mshould apply filters and pagination
[22m[39m[SupplierService] getAllSuppliers called with filters: { status: [32m'active'[39m }

[90mstdout[2m | tests/unit/services/supplier.service.test.ts[2m > [22m[2mSupplierService[2m > [22m[2mgetAllSuppliers[2m > [22m[2mshould apply filters and pagination
[22m[39m[SupplierService] Found 0 suppliers

 [32mΓ£ô[39m tests/unit/contexts/branch-context.test.tsx [2m([22m[2m7 tests[22m[2m)[22m[33m 313[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/contexts/auth-context.test.tsx [2m([22m[2m11 tests[22m[2m)[22m[33m 656[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/components/submit-button.test.tsx [2m([22m[2m9 tests[22m[2m)[22m[33m 398[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/services/supplier.service.test.ts [2m([22m[2m17 tests[22m[2m)[22m[33m 795[2mms[22m[39m
       [33m[2mΓ£ô[22m[39m should update supplier successfully [33m 720[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/services/customer.service.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 1020[2mms[22m[39m
       [33m[2mΓ£ô[22m[39m should create a customer successfully [33m 910[2mms[22m[39m
[90mstdout[2m | tests/unit/services/product.service.test.ts[2m > [22m[2mProductService[2m > [22m[2mdeleteProduct[2m > [22m[2mshould allow deleting active product if Super Admin
[22m[39m{"level":"error","message":"Prisma error","timestamp":"2025-12-19T02:38:43.307Z","context":{"target":"auditLog.create","timestamp":"2025-12-19T02:38:43.307Z","message":"\nInvalid `prisma.auditLog.create()` invocation:\n\n\nForeign key constraint violated on the constraint: `AuditLog_userId_fkey`"}}

[90mstderr[2m | tests/unit/services/product.service.test.ts[2m > [22m[2mProductService[2m > [22m[2mdeleteProduct[2m > [22m[2mshould allow 
deleting active product if Super Admin
[22m[39mAuditService.log error: PrismaClientKnownRequestError: 
Invalid `prisma.auditLog.create()` invocation:


Foreign key constraint violated on the constraint: `AuditLog_userId_fkey`
    at qr.handleRequestError [90m(C:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:65:8172[90m)[39m
    at qr.handleAndLogRequestError 
[90m(C:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:65:7467[90m)[39m
    at qr.request [90m(C:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:65:7174[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at a [90m(C:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:75:5816[90m)[39m
    at AuditService.log (C:/Users/cyber/Documents/GitHub/buenasv2/services/audit.service.ts:75:14)
    at ProductService.deleteProduct (C:/Users/cyber/Documents/GitHub/buenasv2/services/product.service.ts:157:5)
    at C:/Users/cyber/Documents/GitHub/buenasv2/tests/unit/services/product.service.test.ts:145:9
    at [90mfile:///C:/Users/cyber/Documents/GitHub/buenasv2/[39mnode_modules/[4m@vitest[24m/runner/dist/index.js:915:20 {
  code: [32m'P2003'[39m,
  meta: {
    modelName: [32m'AuditLog'[39m,
    driverAdapterError: DriverAdapterError: ForeignKeyConstraintViolation
        at PrismaPgAdapter.onError 
[90m(file:///C:/Users/cyber/Documents/GitHub/buenasv2/[39mnode_modules/[4m@prisma[24m/adapter-pg/dist/index.mjs:657:11[90m)[39m
        at PrismaPgAdapter.performIO 
[90m(file:///C:/Users/cyber/Documents/GitHub/buenasv2/[39mnode_modules/[4m@prisma[24m/adapter-pg/dist/index.mjs:652:12[90m)[39m
    [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
        at PrismaPgAdapter.queryRaw 
[90m(file:///C:/Users/cyber/Documents/GitHub/buenasv2/[39mnode_modules/[4m@prisma[24m/adapter-pg/dist/index.mjs:572:30[90m)[39m
        at [90mC:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:11:24163
        at fr [90m(C:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:11:24002[90m)[39m
        at e.interpretNode [90m(C:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:11:42384[90m)[39m
        at e.interpretNode [90m(C:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:11:42808[90m)[39m
        at e.interpretNode [90m(C:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:11:43982[90m)[39m
        at e.run [90m(C:\Users\cyber\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma[24m\client\runtime\client.js:11:41223[90m)[39m {
      cause: [36m[Object][39m
    }
  },
  clientVersion: [32m'7.1.0'[39m
}

 [31mΓ¥»[39m tests/unit/services/product.service.test.ts [2m([22m[2m9 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 1102[2mms[22m[39m
       [33m[2mΓ£ô[22m[39m should create a product successfully [33m 874[2mms[22m[39m
       [32mΓ£ô[39m should throw error if product name exists[32m 3[2mms[22m[39m
       [32mΓ£ô[39m should throw error if alternate UOM matches base UOM[32m 1[2mms[22m[39m
       [32mΓ£ô[39m should update a product successfully[32m 52[2mms[22m[39m
       [32mΓ£ô[39m should throw error if product not found[32m 1[2mms[22m[39m
       [32mΓ£ô[39m should delete inactive product[32m 49[2mms[22m[39m
[31m       [31m├ù[31m should throw error when deleting active product without role[39m[32m 57[2mms[22m[39m
       [32mΓ£ô[39m should allow deleting active product if Super Admin[32m 60[2mms[22m[39m
       [32mΓ£ô[39m should return base and alternate UOMs[32m 2[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/components/purchase-order-form.test.tsx [2m([22m[2m1 test[22m[2m)[22m[33m 412[2mms[22m[39m
     [33m[2mΓ£ô[22m[39m sets default expected delivery date to today [33m 408[2mms[22m[39m
[90mstdout[2m | tests/unit/validations/sales-agent.validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/validations/sales-agent.validation.test.ts [2m([22m[2m36 tests[22m[2m)[22m[32m 40[2mms[22m[39m
[90mstdout[2m | tests/unit/services/data-maintenance.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/services/data-maintenance.service.test.ts [2m([22m[2m26 tests[22m[2m)[22m[32m 49[2mms[22m[39m
[90mstdout[2m | tests/unit/services/data-maintenance-all.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/warehouse.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/ar-payments-report.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/repositories/data-maintenance.repository.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/services/data-maintenance-all.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 31[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/repositories/data-maintenance.repository.test.ts [2m([22m[2m23 tests[22m[2m)[22m[32m 32[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/services/ar-payments-report.service.test.ts [2m([22m[2m12 tests[22m[2m)[22m[32m 29[2mms[22m[39m
[90mstdout[2m | tests/unit/services/ap.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/lib/uom-conversion.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöÉ prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/warehouse.service.test.ts[2m > [22m[2mWarehouseService[2m > [22m[2mgetWarehouseById[2m > [22m[2mshould return warehouse with details
[22m[39m[WarehouseService] getWarehouseById called with id: wh-1

[90mstdout[2m | tests/unit/services/warehouse.service.test.ts[2m > [22m[2mWarehouseService[2m > [22m[2mgetWarehouseById[2m > [22m[2mshould throw NotFoundError if warehouse does not exist
[22m[39m[WarehouseService] getWarehouseById called with id: non-existent

[90mstdout[2m | tests/unit/services/warehouse.service.test.ts[2m > [22m[2mWarehouseService[2m > [22m[2mgetWarehouseById[2m > [22m[2mshould throw NotFoundError if warehouse does not exist
[22m[39m[WarehouseService] Warehouse not found for id: non-existent

 [32mΓ£ô[39m tests/unit/services/warehouse.service.test.ts [2m([22m[2m21 tests[22m[2m)[22m[32m 36[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/lib/uom-conversion.test.ts [2m([22m[2m25 tests[22m[2m)[22m[32m 25[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/services/ap.service.test.ts [2m([22m[2m11 tests[22m[2m)[22m[32m 25[2mms[22m[39m
[90mstdout[2m | tests/unit/services/alert.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/services/alert.service.test.ts [2m([22m[2m13 tests[22m[2m)[22m[32m 26[2mms[22m[39m
[90mstdout[2m | tests/unit/services/inventory.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/user.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/services/inventory.service.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 27[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/services/user.service.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 28[2mms[22m[39m
[90mstdout[2m | tests/unit/services/purchase-order.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒ¢á∩╕Å  run anywhere with `dotenvx run -- yourcommand`
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/services/purchase-order.service.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 24[2mms[22m[39m
[90mstdout[2m | tests/unit/services/backup.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöä add secrets lifecycle management: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/backup.service.test.ts[2m > [22m[2mBackupService[2m > [22m[2mrestoreBackup[2m > [22m[2mshould execute transaction with deleteMany and createMany calls
[22m[39mStarting restore backup process...
Deleting existing data...

[90mstdout[2m | tests/unit/services/backup.service.test.ts[2m > [22m[2mBackupService[2m > [22m[2mrestoreBackup[2m > [22m[2mshould execute transaction with deleteMany and createMany calls
[22m[39mDeletion complete.
Restoring branches...

[90mstdout[2m | tests/unit/services/backup.service.test.ts[2m > [22m[2mBackupService[2m > [22m[2mrestoreBackup[2m > [22m[2mshould execute transaction with deleteMany and createMany calls
[22m[39mRestoring warehouses...
Restoring roles...
Restoring permissions...
Restoring rolePermissions...
Restoring users...
Restoring userBranchAccess...
Restoring productCategories...
Restoring unitOfMeasures...
Restoring expenseCategories...
Restoring expenseVendors...
Restoring paymentMethods...
Restoring suppliers...

[90mstdout[2m | tests/unit/services/backup.service.test.ts[2m > [22m[2mBackupService[2m > [22m[2mrestoreBackup[2m > [22m[2mshould execute transaction with deleteMany and createMany calls
[22m[39mRestoring customers...
Restoring salesAgents...
Restoring products...
Restoring productUOMs...
Restoring inventory...
Restoring stockMovements...
Restoring purchaseOrders...
Restoring purchaseOrderItems...
Restoring receivingVouchers...
Restoring receivingVoucherItems...
Restoring salesOrders...
Restoring salesOrderItems...
Restoring posSales...
Restoring posSaleItems...
Restoring posReceipts...
Restoring promotionUsages...
Restoring customerPurchaseHistories...
Restoring accountsPayables...
Restoring apPayments...
Restoring accountsReceivables...
Restoring arPayments...
Restoring expenses...
Restoring employeePerformances...
Restoring dailySalesSummaries...
Restoring auditLogs...
Restoring sessions...
Restoring passwordResetTokens...
Restoring reportExports...
Restoring reportTemplates...
Restoring companySettings...
Restore completed successfully.

 [32mΓ£ô[39m tests/unit/services/backup.service.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 16[2mms[22m[39m
[90mstdout[2m | tests/unit/services/ar.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: Γ£à audit secrets and track compliance: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/receiving-voucher.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒôí add observability to secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/sales-order.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒæÑ sync secrets across teammates & machines: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/pos.service.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/unit/services/inventory-average-cost.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöÉ encrypt with Dotenvx: https://dotenvx.com
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/services/ar.service.test.ts [2m([22m[2m14 tests[22m[2m)[22m[32m 32[2mms[22m[39m
[90mstdout[2m | tests/unit/validations/customer.validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ΓÜÖ∩╕Å  write to custom object with { processEnv: myObject }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒùé∩╕Å backup and recover secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/validations/customer.validation.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 15[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/services/inventory-average-cost.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 17[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/services/sales-order.service.test.ts [2m([22m[2m2 tests[22m[2m)[22m[32m 16[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/services/pos.service.test.ts [2m([22m[2m8 tests[22m[2m)[22m[32m 12[2mms[22m[39m
[90mstdout[2m | tests/unit/validations/supplier.validation.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ≡ƒöÉ prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.3] injecting env (0) from .env -- tip: ≡ƒöæ add access controls to secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

 [32mΓ£ô[39m tests/unit/validations/supplier.validation.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 8[2mms[22m[39m
 [32mΓ£ô[39m tests/unit/services/receiving-voucher.service.test.ts [2m([22m[2m5 tests[22m[2m)[22m[32m 14[2mms[22m[39m

[31mΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[39m[1m[41m Failed Tests 3 [49m[22m[31mΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[39m

[41m[1m FAIL [22m[49m tests/unit/services/auth.service.test.ts[2m > [22mAuthService[2m > [22mregisterUser[2m > [22mshould successfully register 
a new user
[31m[1mAssertionError[22m: expected "vi.fn()" to be called with arguments: [ 'password123', 14 ][90m

Received: 

[1m  1st vi.fn() call:

[22m[2m  [[22m
[2m    "password123",[22m
[32m-   14,[90m
[31m+   4,[90m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
[36m [2mΓ¥»[22m tests/unit/services/auth.service.test.ts:[2m125:33[22m[39m
    [90m123| [39m
    [90m124| [39m            expect(userRepository.findByEmail).toHaveBeenCalledWith(reΓÇª
    [90m125| [39m            expect(bcrypt.hash).toHaveBeenCalledWith(registerInput.pasΓÇª
    [90m   | [39m                                [31m^[39m
    [90m126| [39m            [34mexpect[39m(userRepository[33m.[39mcreate)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m
    [90m127| [39m            [34mexpect[39m(auditLogRepository[33m.[39mcreate)[33m.[39m[34mtoHaveBeenCalled[39m()[33m;[39m

[31m[2mΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[1/3]ΓÄ»[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/auth.service.test.ts[2m > [22mAuthService[2m > [22mlogin[2m > [22mshould fail if user is inactive
[31m[1mAssertionError[22m: expected 'Account is inactive, suspended, or peΓÇª' to be 'Account is inactive or suspended' // Object.is equality[39m

Expected: [32m"Account is inactive[7m or[27m suspended"[39m
Received: [31m"Account is inactive[7m,[27m suspended[7m, or pending verification[27m"[39m

[36m [2mΓ¥»[22m tests/unit/services/auth.service.test.ts:[2m210:36[22m[39m
    [90m208| [39m
    [90m209| [39m            [34mexpect[39m(result[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m210| [39m            expect(result.message).toBe('Account is inactive or suspenΓÇª
    [90m   | [39m                                   [31m^[39m
    [90m211| [39m        })[33m;[39m
    [90m212| [39m

[31m[2mΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[2/3]ΓÄ»[22m[39m

[41m[1m FAIL [22m[49m tests/unit/services/product.service.test.ts[2m > [22mProductService[2m > [22mdeleteProduct[2m > [22mshould throw error 
when deleting active product without role
[31m[1mAssertionError[22m: promise resolved "undefined" instead of rejecting[39m

[32m- Expected:[39m 
Error {
  "message": "rejected promise",
}

[31m+ Received:[39m 
undefined

[36m [2mΓ¥»[22m tests/unit/services/product.service.test.ts:[2m136:52[22m[39m
    [90m134| [39m      vi.mocked(productRepository.findById).mockResolvedValue(product ΓÇª
    [90m135| [39m
    [90m136| [39m      await expect(productService.deleteProduct(id)).rejects.toThrow(VΓÇª
    [90m   | [39m                                                   [31m^[39m
    [90m137| [39m    })[33m;[39m
    [90m138| [39m

[31m[2mΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»ΓÄ»[3/3]ΓÄ»[22m[39m


[2m Test Files [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m29 passed[39m[22m[90m (31)[39m
[2m      Tests [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m345 passed[39m[22m[90m (348)[39m
[2m   Start at [22m 10:38:38
[2m   Duration [22m 10.44s[2m (transform 6.25s, setup 9.05s, import 13.31s, tests 5.50s, environment 50.48s)[22m

error: script "test:unit" exited with code 1

