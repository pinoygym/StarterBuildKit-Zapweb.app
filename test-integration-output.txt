
> inventory-pro@0.1.0 test:integration
> vitest run tests/integration


[1m[46m RUN [49m[22m [36mv4.0.8 [39m[90mC:/Users/HI/Documents/GitHub/_deve local/_React Apps/test[39m

[90mstdout[2m | tests/integration/api/ar.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/api/registration.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/api/receiving-voucher-uom.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/api/ap.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/api/products.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/api/auth.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39mğŸ” Starting Reproduction Test for RV Average Cost Anomaly...

1ï¸âƒ£ Setting up test data...

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   Created Product: Test Product c6f4a3ac (Base: pcs, Alt: box=10pcs)

2ï¸âƒ£ Scenario 1: First Receipt (1 box @ 100)

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   RV Created: RV-20251130-0004
   Average Cost: 10
   Expected: 10

3ï¸âƒ£ Scenario 2: Second Receipt (1 box @ 200)

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   RV Created: RV-20251130-0005
   Average Cost: 15
   Expected: 15

4ï¸âƒ£ Scenario 3: Third Receipt (1 box @ 100 with 20 discount)

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   RV Created: RV-20251130-0006
   Average Cost: 12.66666666666667
   Expected: 12.67

ğŸ§¹ Cleaning up...

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m{"level":"error","message":"Prisma error","timestamp":"2025-11-29T16:39:29.203Z","context":{"target":"supplier.delete","timestamp":"2025-11-29T16:39:29.203Z","message":"\nInvalid `prisma.supplier.delete()` invocation:\n\n\nForeign key constraint violated on the constraint: `AccountsPayable_supplierId_fkey`"}}

[90mstderr[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39mCleanup failed PrismaClientKnownRequestError: 
Invalid `prisma.supplier.delete()` invocation:


Foreign key constraint violated on the constraint: `AccountsPayable_supplierId_fkey`
    at $r.handleRequestError [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:65:7347[90m)[39m
    at $r.handleAndLogRequestError [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:65:6642[90m)[39m
    at $r.request [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:65:6349[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at a [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:75:5816[90m)[39m
    at C:/Users/HI/Documents/GitHub/_deve local/_React Apps/test/tests/integration/reproduce_rv_avg_cost.test.ts:236:31
    at [90mfile:///C:/Users/HI/Documents/GitHub/_deve%20local/_React%20Apps/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:753:20 {
  code: [32m'P2003'[39m,
  meta: {
    modelName: [32m'Supplier'[39m,
    driverAdapterError: DriverAdapterError: ForeignKeyConstraintViolation
        at PrismaPgAdapter.onError [90m(file:///C:/Users/HI/Documents/GitHub/_deve%20local/_React%20Apps/test/[39mnode_modules/[4m@prisma/adapter-pg[24m/dist/index.mjs:657:11[90m)[39m
        at PrismaPgAdapter.performIO [90m(file:///C:/Users/HI/Documents/GitHub/_deve%20local/_React%20Apps/test/[39mnode_modules/[4m@prisma/adapter-pg[24m/dist/index.mjs:652:12[90m)[39m
    [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
        at PrismaPgAdapter.queryRaw [90m(file:///C:/Users/HI/Documents/GitHub/_deve%20local/_React%20Apps/test/[39mnode_modules/[4m@prisma/adapter-pg[24m/dist/index.mjs:572:30[90m)[39m
        at [90mC:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:23732
        at mr [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:23571[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:41866[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:42290[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:41116[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:43464[90m)[39m {
      cause: [36m[Object][39m
    }
  },
  clientVersion: [32m'7.0.0'[39m
}

 [32mâœ“[39m tests/integration/reproduce_rv_avg_cost.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 10438[2mms[22m[39m
     [33m[2mâœ“[22m[39m should calculate weighted average cost correctly across multiple receipts [33m 10436[2mms[22m[39m
[90mstderr[2m | tests/integration/api/receiving-voucher-uom.test.ts[2m > [22m[2mReceiving Voucher UOM Conversion Integration Tests
[22m[39mLogin failed: {
  "success": false,
  "message": "Too many attempts. Please try again later."
}

[90mstderr[2m | tests/integration/api/purchase-orders.test.ts[2m > [22m[2mPurchase Orders API Integration Tests
[22m[39mLogin failed: {
  "success": false,
  "message": "Too many attempts. Please try again later."
}
Setup failed Error: Login failed
    at C:/Users/HI/Documents/GitHub/_deve local/_React Apps/test/tests/integration/api/purchase-orders.test.ts:37:15
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

[90mstderr[2m | tests/integration/api/sales-orders.test.ts[2m > [22m[2mSales Orders API Integration Tests
[22m[39mLogin failed: {
  "success": false,
  "message": "Too many attempts. Please try again later."
}
Setup failed Error: Login failed
    at C:/Users/HI/Documents/GitHub/_deve local/_React Apps/test/tests/integration/api/sales-orders.test.ts:37:23
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

 [31mâ¯[39m tests/integration/api/sales-orders.test.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 13289[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new sales order
       [2m[90mâ†“[39m[22m should return 400 for invalid SO data
       [2m[90mâ†“[39m[22m should return list of sales orders
       [2m[90mâ†“[39m[22m should return a sales order by ID
       [2m[90mâ†“[39m[22m should update sales order
       [2m[90mâ†“[39m[22m should cancel sales order
 [31mâ¯[39m tests/integration/api/purchase-orders.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 13460[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new purchase order
       [2m[90mâ†“[39m[22m should return 400 for invalid PO data
       [2m[90mâ†“[39m[22m should return list of purchase orders
       [2m[90mâ†“[39m[22m should filter purchase orders by status
       [2m[90mâ†“[39m[22m should return a purchase order by ID
       [2m[90mâ†“[39m[22m should return 404 for non-existent PO
       [2m[90mâ†“[39m[22m should update purchase order
       [2m[90mâ†“[39m[22m should cancel purchase order
 [31mâ¯[39m tests/integration/api/receiving-voucher-uom.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[33m 13207[2mms[22m[39m
       [2m[90mâ†“[39m[22m should successfully create receiving voucher with case to bottle conversion
       [2m[90mâ†“[39m[22m should handle partial case receipt (0.5 case = 5 bottles)
       [2m[90mâ†“[39m[22m should work with pack UOM conversion
       [2m[90mâ†“[39m[22m should fail with invalid UOM configuration
       [2m[90mâ†“[39m[22m should prevent the original UOM conversion bug
[90mstderr[2m | tests/integration/api/pos.test.ts[2m > [22m[2mPOS Sales API
[22m[39mLogin failed: {
  "success": false,
  "message": "Too many attempts. Please try again later."
}

[90mstderr[2m | tests/integration/api/warehouses.test.ts[2m > [22m[2mWarehouses API
[22m[39mLogin failed: {
  "success": false,
  "message": "Too many attempts. Please try again later."
}

 [31mâ¯[39m tests/integration/api/warehouses.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 13430[2mms[22m[39m
     [2m[90mâ†“[39m[22m lists warehouses
 [31mâ¯[39m tests/integration/api/pos.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 13421[2mms[22m[39m
     [2m[90mâ†“[39m[22m processes a cash sale
     [2m[90mâ†“[39m[22m deducts inventory correctly after sale
[90mstdout[2m | tests/integration/api/api-regression.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstderr[2m | tests/integration/api/inventory.test.ts[2m > [22m[2mInventory API
[22m[39mLogin failed: {
  "success": false,
  "message": "\nInvalid `prisma.session.create()` invocation:\n\n\nUnique constraint failed on the fields: (`token`)"
}

 [31mâ¯[39m tests/integration/api/inventory.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 14361[2mms[22m[39m
     [2m[90mâ†“[39m[22m lists inventory
     [2m[90mâ†“[39m[22m stock levels endpoint
 [32mâœ“[39m tests/integration/api/auth.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 14357[2mms[22m[39m
     [33m[2mâœ“[22m[39m invalid login returns 401 [33m 4916[2mms[22m[39m
     [33m[2mâœ“[22m[39m valid login returns 200 and me returns 200 with cookie [33m 7625[2mms[22m[39m
 [31mâ¯[39m tests/integration/api/receiving-voucher-transaction.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 14824[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create RV, update inventory, and record stock movement in single transaction
       [2m[90mâ†“[39m[22m should rollback all changes if any operation fails
       [2m[90mâ†“[39m[22m should handle multiple items in single transaction
       [2m[90mâ†“[39m[22m should not throw 500 error due to nested transactions
[90mstderr[2m | tests/integration/api/products.test.ts[2m > [22m[2mProducts API Integration Tests
[22m[39mLogin failed: {
  "success": false,
  "message": "\nInvalid `prisma.session.create()` invocation:\n\n\nUnique constraint failed on the fields: (`token`)"
}

 [31mâ¯[39m tests/integration/api/products.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 15001[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new product
       [2m[90mâ†“[39m[22m should return 400 for invalid product data
       [2m[90mâ†“[39m[22m should return list of products
       [2m[90mâ†“[39m[22m should filter products by category
       [2m[90mâ†“[39m[22m should return a product by ID
       [2m[90mâ†“[39m[22m should return 404 for non-existent product
       [2m[90mâ†“[39m[22m should update product details
       [2m[90mâ†“[39m[22m should delete (or deactivate) product
 [32mâœ“[39m tests/integration/api/products-uom.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 17795[2mms[22m[39m
     [33m[2mâœ“[22m[39m updates product alternate UOMs [33m 2529[2mms[22m[39m
 [32mâœ“[39m tests/integration/api/api-regression.test.ts [2m([22m[2m7 tests[22m[2m)[22m[33m 4249[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return PO with correct Prisma relation names (capital letters) [33m 702[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list POs with correct property names [33m 662[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return RV with correct Prisma relation names [33m 1166[2mms[22m[39m
 [32mâœ“[39m tests/integration/api/customers.test.ts [2m([22m[2m7 tests[22m[2m)[22m[33m 18417[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create a new customer [33m 4648[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return list of customers [33m 513[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter customers by search [33m 901[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return customer by ID [33m 2283[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update customer details [33m 747[2mms[22m[39m
       [33m[2mâœ“[22m[39m should delete (or deactivate) customer [33m 501[2mms[22m[39m
 [31mâ¯[39m tests/integration/api/registration.test.ts [2m([22m[2m10 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 24966[2mms[22m[39m
       [33m[2mâœ“[22m[39m should successfully register a new user with valid data [33m 3166[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject registration with duplicate email [33m 2365[2mms[22m[39m
       [32mâœ“[39m should reject registration with short password[32m 94[2mms[22m[39m
       [32mâœ“[39m should reject registration with invalid email format[32m 92[2mms[22m[39m
       [32mâœ“[39m should reject registration with missing required fields[32m 88[2mms[22m[39m
[31m       [31mÃ—[31m should reject registration with invalid role ID[39m[33m 758[2mms[22m[39m
       [33m[2mâœ“[22m[39m should hash password before storing in database [33m 1121[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create audit log entry for registration [33m 1289[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not include updatedAt field in user creation (regression test) [33m 1140[2mms[22m[39m
       [33m[2mâœ“[22m[39m should work with correct Cashier role ID (regression test) [33m 1094[2mms[22m[39m
 [31mâ¯[39m tests/integration/api/ar.test.ts [2m([22m[2m14 tests[22m[2m | [22m[31m6 failed[39m[2m)[22m[33m 28171[2mms[22m[39m
[31m       [31mÃ—[31m should create AR record successfully[39m[33m 2314[2mms[22m[39m
       [32mâœ“[39m should validate required fields[32m 50[2mms[22m[39m
[31m       [31mÃ—[31m should record full payment and update status to paid[39m[33m 1872[2mms[22m[39m
[31m       [31mÃ—[31m should record partial payment and update status to partial[39m[33m 1428[2mms[22m[39m
[31m       [31mÃ—[31m should handle multiple partial payments[39m[33m 2558[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject payment exceeding balance [33m 483[2mms[22m[39m
[31m       [31mÃ—[31m should reject zero or negative payment[39m[32m 283[2mms[22m[39m
       [32mâœ“[39m should validate required payment fields[32m 209[2mms[22m[39m
[31m       [31mÃ—[31m should calculate aging buckets correctly[39m[33m 915[2mms[22m[39m
       [33m[2mâœ“[22m[39m should group by customer correctly [33m 478[2mms[22m[39m
       [33m[2mâœ“[22m[39m should calculate total outstanding correctly [33m 502[2mms[22m[39m
       [33m[2mâœ“[22m[39m should fetch all AR records [33m 450[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter by status [33m 451[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter by branch [33m 416[2mms[22m[39m
 [32mâœ“[39m tests/integration/api/ap.test.ts [2m([22m[2m15 tests[22m[2m)[22m[33m 32505[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create AP record successfully [33m 5271[2mms[22m[39m
       [33m[2mâœ“[22m[39m should validate required fields [33m 2147[2mms[22m[39m
       [33m[2mâœ“[22m[39m should record full payment and update status to paid [33m 2783[2mms[22m[39m
       [33m[2mâœ“[22m[39m should record partial payment and update status to partial [33m 1575[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle multiple partial payments [33m 3119[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject payment exceeding balance [33m 669[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject zero or negative payment [33m 500[2mms[22m[39m
       [33m[2mâœ“[22m[39m should validate required payment fields [33m 419[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle different payment methods [33m 4296[2mms[22m[39m
       [33m[2mâœ“[22m[39m should calculate aging buckets correctly [33m 811[2mms[22m[39m
       [33m[2mâœ“[22m[39m should calculate total outstanding correctly [33m 544[2mms[22m[39m
       [33m[2mâœ“[22m[39m should fetch all AP records [33m 582[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter by status [33m 531[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter by branch [33m 445[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter by supplier [33m 443[2mms[22m[39m

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Suites 8 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/integration/api/inventory.test.ts[2m > [22mInventory API
[31m[1mError[22m: Login failed[39m
[36m [2mâ¯[22m tests/integration/api/inventory.test.ts:[2m31:13[22m[39m
    [90m 29| [39m    [35mif[39m ([33m![39mloginData[33m.[39msuccess) {
    [90m 30| [39m      console.error('Login failed:', JSON.stringify(loginData, null, 2â€¦
    [90m 31| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'Login failed'[39m)
    [90m   | [39m            [31m^[39m
    [90m 32| [39m    }
    [90m 33| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/pos.test.ts[2m > [22mPOS Sales API
[31m[1mError[22m: Login failed[39m
[36m [2mâ¯[22m tests/integration/api/pos.test.ts:[2m40:13[22m[39m
    [90m 38| [39m    [35mif[39m ([33m![39mloginData[33m.[39msuccess) {
    [90m 39| [39m      console.error('Login failed:', JSON.stringify(loginData, null, 2â€¦
    [90m 40| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'Login failed'[39m)
    [90m   | [39m            [31m^[39m
    [90m 41| [39m    }
    [90m 42| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/products.test.ts[2m > [22mProducts API Integration Tests
[31m[1mError[22m: Login failed[39m
[36m [2mâ¯[22m tests/integration/api/products.test.ts:[2m32:13[22m[39m
    [90m 30| [39m    [35mif[39m ([33m![39mloginData[33m.[39msuccess) {
    [90m 31| [39m      console.error('Login failed:', JSON.stringify(loginData, null, 2â€¦
    [90m 32| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'Login failed'[39m)
    [90m   | [39m            [31m^[39m
    [90m 33| [39m    }
    [90m 34| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/purchase-orders.test.ts[2m > [22mPurchase Orders API Integration Tests
[31m[1mError[22m: Login failed[39m
[36m [2mâ¯[22m tests/integration/api/purchase-orders.test.ts:[2m37:15[22m[39m
    [90m 35| [39m      [35mif[39m ([33m![39mloginData[33m.[39msuccess) {
    [90m 36| [39m        console.error('Login failed:', JSON.stringify(loginData, null,â€¦
    [90m 37| [39m        [35mthrow[39m [35mnew[39m [33mError[39m([32m'Login failed'[39m)
    [90m   | [39m              [31m^[39m
    [90m 38| [39m      }
    [90m 39| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22mReceiving Voucher Transaction Integrity Tests
[31m[1mError[22m: Login failed[39m
[36m [2mâ¯[22m tests/integration/api/receiving-voucher-transaction.test.ts:[2m42:19[22m[39m
    [90m 40| [39m
    [90m 41| [39m        [35mif[39m ([33m![39mloginData[33m.[39msuccess) {
    [90m 42| [39m            [35mthrow[39m [35mnew[39m [33mError[39m([32m'Login failed'[39m)[33m;[39m
    [90m   | [39m                  [31m^[39m
    [90m 43| [39m        }
    [90m 44| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22mReceiving Voucher Transaction Integrity Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2mâ¯[22m tests/integration/api/receiving-voucher-transaction.test.ts:[2m122:85[22m[39m
    [90m120| [39m
    [90m121| [39m    [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m122| [39m        await prisma.accountsPayable.deleteMany({ where: { supplierId:â€¦
    [90m   | [39m                                                                                    [31m^[39m
    [90m123| [39m        await prisma.purchaseOrderItem.deleteMany({ where: { poId: tesâ€¦
    [90m124| [39m        await prisma.purchaseOrder.delete({ where: { id: testPurchaseOâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-uom.test.ts[2m > [22mReceiving Voucher UOM Conversion Integration Tests
[31m[1mError[22m: Login failed[39m
[36m [2mâ¯[22m tests/integration/api/receiving-voucher-uom.test.ts:[2m39:13[22m[39m
    [90m 37| [39m    [35mif[39m ([33m![39mloginData[33m.[39msuccess) {
    [90m 38| [39m      console.error('Login failed:', JSON.stringify(loginData, null, 2â€¦
    [90m 39| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'Login failed'[39m)
    [90m   | [39m            [31m^[39m
    [90m 40| [39m    }
    [90m 41| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-uom.test.ts[2m > [22mReceiving Voucher UOM Conversion Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2mâ¯[22m tests/integration/api/receiving-voucher-uom.test.ts:[2m157:40[22m[39m
    [90m155| [39m    [90m// Clean up all test data[39m
    [90m156| [39m    [35mawait[39m prisma[33m.[39mpurchaseOrderItem[33m.[39m[34mdeleteMany[39m({
    [90m157| [39m      where[33m:[39m { poId[33m:[39m testPurchaseOrder[33m.[39mid }[33m,[39m
    [90m   | [39m                                       [31m^[39m
    [90m158| [39m    })[33m;[39m
    [90m159| [39m    await prisma.purchaseOrder.delete({ where: { id: testPurchaseOrderâ€¦

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/sales-orders.test.ts[2m > [22mSales Orders API Integration Tests
[31m[1mError[22m: Login failed[39m
[36m [2mâ¯[22m tests/integration/api/sales-orders.test.ts:[2m37:23[22m[39m
    [90m 35| [39m            [35mif[39m ([33m![39mloginData[33m.[39msuccess) {
    [90m 36| [39m                console.error('Login failed:', JSON.stringify(loginDatâ€¦
    [90m 37| [39m                [35mthrow[39m [35mnew[39m [33mError[39m([32m'Login failed'[39m)
    [90m   | [39m                      [31m^[39m
    [90m 38| [39m            }
    [90m 39| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/warehouses.test.ts[2m > [22mWarehouses API
[31m[1mError[22m: Login failed[39m
[36m [2mâ¯[22m tests/integration/api/warehouses.test.ts:[2m31:13[22m[39m
    [90m 29| [39m    [35mif[39m ([33m![39mloginData[33m.[39msuccess) {
    [90m 30| [39m      console.error('Login failed:', JSON.stringify(loginData, null, 2â€¦
    [90m 31| [39m      [35mthrow[39m [35mnew[39m [33mError[39m([32m'Login failed'[39m)
    [90m   | [39m            [31m^[39m
    [90m 32| [39m    }
    [90m 33| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[10/17]â¯[22m[39m


[31mâ¯â¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Tests 7 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/integration/api/ar.test.ts[2m > [22mAccounts Receivable API Integration Tests[2m > [22mPOST /api/ar - Create AR[2m > [22mshould create AR record successfully
[31m[1mAssertionError[22m: expected 1000 to be '1000' // Object.is equality[39m

[32m- Expected:[39m 
"1000"

[31m+ Received:[39m 
1000

[36m [2mâ¯[22m tests/integration/api/ar.test.ts:[2m97:37[22m[39m
    [90m 95| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m 96| [39m      [34mexpect[39m(data[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m 97| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mtotalAmount)[33m.[39m[34mtoBe[39m([32m'1000'[39m)[33m;[39m
    [90m   | [39m                                    [31m^[39m
    [90m 98| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mpaidAmount)[33m.[39m[34mtoBe[39m([32m'0'[39m)[33m;[39m
    [90m 99| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mbalance)[33m.[39m[34mtoBe[39m([32m'1000'[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[11/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ar.test.ts[2m > [22mAccounts Receivable API Integration Tests[2m > [22mPOST /api/ar/payment - Record Payment[2m > [22mshould record full payment and update status to paid
[31m[1mAssertionError[22m: expected 1000 to be '1000' // Object.is equality[39m

[32m- Expected:[39m 
"1000"

[31m+ Received:[39m 
1000

[36m [2mâ¯[22m tests/integration/api/ar.test.ts:[2m160:36[22m[39m
    [90m158| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m159| [39m      [34mexpect[39m(data[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m160| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mpaidAmount)[33m.[39m[34mtoBe[39m([32m'1000'[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m161| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mbalance)[33m.[39m[34mtoBe[39m([32m'0'[39m)[33m;[39m
    [90m162| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'paid'[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[12/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ar.test.ts[2m > [22mAccounts Receivable API Integration Tests[2m > [22mPOST /api/ar/payment - Record Payment[2m > [22mshould record partial payment and update status to partial
[31m[1mAssertionError[22m: expected 500 to be '500' // Object.is equality[39m

[32m- Expected:[39m 
"500"

[31m+ Received:[39m 
500

[36m [2mâ¯[22m tests/integration/api/ar.test.ts:[2m191:36[22m[39m
    [90m189| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m190| [39m      [34mexpect[39m(data[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mtrue[39m)[33m;[39m
    [90m191| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mpaidAmount)[33m.[39m[34mtoBe[39m([32m'500'[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m192| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mbalance)[33m.[39m[34mtoBe[39m([32m'500'[39m)[33m;[39m
    [90m193| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'partial'[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[13/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ar.test.ts[2m > [22mAccounts Receivable API Integration Tests[2m > [22mPOST /api/ar/payment - Record Payment[2m > [22mshould handle multiple partial payments
[31m[1mAssertionError[22m: expected 1000 to be '1000' // Object.is equality[39m

[32m- Expected:[39m 
"1000"

[31m+ Received:[39m 
1000

[36m [2mâ¯[22m tests/integration/api/ar.test.ts:[2m236:36[22m[39m
    [90m234| [39m
    [90m235| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m200[39m)[33m;[39m
    [90m236| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mpaidAmount)[33m.[39m[34mtoBe[39m([32m'1000'[39m)[33m;[39m
    [90m   | [39m                                   [31m^[39m
    [90m237| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mbalance)[33m.[39m[34mtoBe[39m([32m'0'[39m)[33m;[39m
    [90m238| [39m      [34mexpect[39m(data[33m.[39mdata[33m.[39mstatus)[33m.[39m[34mtoBe[39m([32m'paid'[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[14/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ar.test.ts[2m > [22mAccounts Receivable API Integration Tests[2m > [22mPOST /api/ar/payment - Record Payment[2m > [22mshould reject zero or negative payment
[31m[1mAssertionError[22m: expected 'Missing required fields' to contain 'greater than 0'[39m

Expected: [32m"greater than 0"[39m
Received: [31m"Missing required fields"[39m

[36m [2mâ¯[22m tests/integration/api/ar.test.ts:[2m287:26[22m[39m
    [90m285| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m286| [39m      [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m287| [39m      [34mexpect[39m(data[33m.[39merror)[33m.[39m[34mtoContain[39m([32m'greater than 0'[39m)[33m;[39m
    [90m   | [39m                         [31m^[39m
    [90m288| [39m    })[33m;[39m
    [90m289| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[15/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ar.test.ts[2m > [22mAccounts Receivable API Integration Tests[2m > [22mGET /api/ar/aging-report - Aging Analysis[2m > [22mshould calculate aging buckets correctly
[31m[1mAssertionError[22m: expected 2 to be 1 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 1[39m
[31m+ 2[39m

[36m [2mâ¯[22m tests/integration/api/ar.test.ts:[2m404:31[22m[39m
    [90m402| [39m      const bucket90plus = buckets.find((b: any) => b.bucket === '90+'â€¦
    [90m403| [39m
    [90m404| [39m      [34mexpect[39m(bucket030[33m.[39mcount)[33m.[39m[34mtoBe[39m([34m1[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m405| [39m      [34mexpect[39m([34mparseFloat[39m(bucket030[33m.[39mtotalAmount))[33m.[39m[34mtoBe[39m([34m1000[39m)[33m;[39m
    [90m406| [39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[16/17]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/registration.test.ts[2m > [22mRegistration API Integration Tests[2m > [22mPOST /api/auth/register[2m > [22mshould reject registration with invalid role ID
[31m[1mAssertionError[22m: expected 500 to be 400 // Object.is equality[39m

[32m- Expected[39m
[31m+ Received[39m

[32m- 400[39m
[31m+ 500[39m

[36m [2mâ¯[22m tests/integration/api/registration.test.ts:[2m198:31[22m[39m
    [90m196| [39m      [35mconst[39m data [33m=[39m [35mawait[39m response[33m.[39m[34mjson[39m()[33m;[39m
    [90m197| [39m
    [90m198| [39m      [34mexpect[39m(response[33m.[39mstatus)[33m.[39m[34mtoBe[39m([34m400[39m)[33m;[39m
    [90m   | [39m                              [31m^[39m
    [90m199| [39m      [34mexpect[39m(data[33m.[39msuccess)[33m.[39m[34mtoBe[39m([35mfalse[39m)[33m;[39m
    [90m200| [39m      [34mexpect[39m(data[33m.[39mmessage)[33m.[39m[34mtoContain[39m([32m'Invalid role'[39m)[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[17/17]â¯[22m[39m


[2m Test Files [22m [1m[31m10 failed[39m[22m[2m | [22m[1m[32m6 passed[39m[22m[90m (16)[39m
[2m      Tests [22m [1m[31m7 failed[39m[22m[2m | [22m[1m[32m50 passed[39m[22m[2m | [22m[33m36 skipped[39m[90m (93)[39m
[2m   Start at [22m 00:39:14
[2m   Duration [22m 35.61s[2m (transform 1.99s, setup 4.03s, collect 4.96s, tests 261.89s, environment 26.30s, prepare 857ms)[22m

