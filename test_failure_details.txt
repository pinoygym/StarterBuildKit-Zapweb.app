$ vitest run tests/integration --fileParallelism=false tests/integration/api/receiving-voucher-uom.test.ts

[1m[46m RUN [49m[22m [36mv4.0.15 [39m[90mC:/Users/HI/Documents/GitHub/buenasv2[39m

[90mstdout[2m | tests/integration/api/registration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:09.940Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/registration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/registration.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/registration.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 914[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should successfully register a new user with valid data
       [2m[90m‚Üì[39m[22m should reject registration with duplicate email
       [2m[90m‚Üì[39m[22m should reject registration with short password
       [2m[90m‚Üì[39m[22m should reject registration with invalid email format
       [2m[90m‚Üì[39m[22m should reject registration with missing required fields
       [2m[90m‚Üì[39m[22m should reject registration with invalid role ID
       [2m[90m‚Üì[39m[22m should hash password before storing in database
       [2m[90m‚Üì[39m[22m should create audit log entry for registration
       [2m[90m‚Üì[39m[22m should not include updatedAt field in user creation (regression test)
       [2m[90m‚Üì[39m[22m should work with correct Cashier role ID (regression test)
[90mstdout[2m | tests/integration/api/data-maintenance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:11.201Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/data-maintenance.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/data-maintenance.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/data-maintenance.test.ts [2m([22m[2m10 tests[22m[2m | [22m[33m10 skipped[39m[2m)[22m[33m 780[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create a new product category
       [2m[90m‚Üì[39m[22m should return 400 for existing name
       [2m[90m‚Üì[39m[22m should return 400 for existing code
       [2m[90m‚Üì[39m[22m should return list of product categories
       [2m[90m‚Üì[39m[22m should update product category details
       [2m[90m‚Üì[39m[22m should delete product category
       [2m[90m‚Üì[39m[22m should create expense category
       [2m[90m‚Üì[39m[22m should delete expense category
       [2m[90m‚Üì[39m[22m should create unit of measure
       [2m[90m‚Üì[39m[22m should delete unit of measure
[90mstdout[2m | tests/integration/api/ar.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:12.315Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/ar.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/ar.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/ar.test.ts [2m([22m[2m14 tests[22m[2m | [22m[33m14 skipped[39m[2m)[22m[33m 829[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create AR record successfully
       [2m[90m‚Üì[39m[22m should validate required fields
       [2m[90m‚Üì[39m[22m should record full payment and update status to paid
       [2m[90m‚Üì[39m[22m should record partial payment and update status to partial
       [2m[90m‚Üì[39m[22m should handle multiple partial payments
       [2m[90m‚Üì[39m[22m should reject payment exceeding balance
       [2m[90m‚Üì[39m[22m should reject zero or negative payment
       [2m[90m‚Üì[39m[22m should validate required payment fields
       [2m[90m‚Üì[39m[22m should calculate aging buckets correctly
       [2m[90m‚Üì[39m[22m should group by customer correctly
       [2m[90m‚Üì[39m[22m should calculate total outstanding correctly
       [2m[90m‚Üì[39m[22m should fetch all AR records
       [2m[90m‚Üì[39m[22m should filter by status
       [2m[90m‚Üì[39m[22m should filter by branch
[90mstdout[2m | tests/integration/api/receiving-voucher-uom.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:13.482Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/receiving-voucher-uom.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/receiving-voucher-uom.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/receiving-voucher-uom.test.ts[2m > [22m[2mReceiving Voucher UOM Conversion Integration Tests
[22m[39mTest BASE_URL: http://localhost:3001 

 [31m‚ùØ[39m tests/integration/api/receiving-voucher-uom.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[33m 842[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should successfully create receiving voucher with case to bottle conversion
       [2m[90m‚Üì[39m[22m should handle partial case receipt (0.5 case = 5 bottles)
       [2m[90m‚Üì[39m[22m should work with pack UOM conversion
       [2m[90m‚Üì[39m[22m should fail with invalid UOM configuration
       [2m[90m‚Üì[39m[22m should prevent the original UOM conversion bug
[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:15.262Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/receiving-voucher-transaction.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests
[22m[39mTransaction Test BASE_URL: http://localhost:3001 

 [31m‚ùØ[39m tests/integration/api/receiving-voucher-transaction.test.ts [2m([22m[2m4 tests[22m[2m | [22m[33m4 skipped[39m[2m)[22m[33m 875[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create RV, update inventory, and record stock movement in single transaction
       [2m[90m‚Üì[39m[22m should rollback all changes if any operation fails
       [2m[90m‚Üì[39m[22m should handle multiple items in single transaction
       [2m[90m‚Üì[39m[22m should not throw 500 error due to nested transactions
[90mstdout[2m | tests/integration/api/receiving-voucher-list.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:17.066Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/receiving-voucher-list.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/receiving-voucher-list.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/receiving-voucher-list.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 846[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should show newly created receiving voucher in the list
[90mstdout[2m | tests/integration/api/adjustments.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:18.846Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/adjustments.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/adjustments.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/adjustments.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 1333[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should return 401 without auth token
       [2m[90m‚Üì[39m[22m should return list of adjustments with auth
       [2m[90m‚Üì[39m[22m should filter by warehouseId
       [2m[90m‚Üì[39m[22m should filter by search query
       [2m[90m‚Üì[39m[22m should return 401 without auth token
       [2m[90m‚Üì[39m[22m should return 404 for non-existent adjustment
       [2m[90m‚Üì[39m[22m should return adjustment details with auth
       [2m[90m‚Üì[39m[22m should include product and warehouse details
[90mstdout[2m | tests/integration/api/adjustments-batch-verification.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:21.104Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/adjustments-batch-verification.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/adjustments-batch-verification.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/adjustments-batch-verification.test.ts[2m > [22m[2mBatch Inventory Adjustment Verification (50 Items)
[22m[39mSetup: Creating test user and environment...

[90mstdout[2m | tests/integration/api/adjustments-batch-verification.test.ts[2m > [22m[2mBatch Inventory Adjustment Verification (50 Items)
[22m[39mCreating 50 test products...

[90mstdout[2m | tests/integration/api/adjustments-batch-verification.test.ts[2m > [22m[2mBatch Inventory Adjustment Verification (50 Items)
[22m[39mCreated 50 products.

[90mstderr[2m | tests/integration/api/adjustments-batch-verification.test.ts[2m > [22m[2mBatch Inventory Adjustment Verification (50 Items)
[22m[39mSetup failed: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/api/adjustments-batch-verification.test.ts:40:30 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/api/adjustments-batch-verification.test.ts:40:36
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/adjustments-batch-verification.test.ts[2m > [22m[2mBatch Inventory Adjustment Verification (50 Items)
[22m[39mCleaning up...

[90mstdout[2m | tests/integration/api/adjustments-batch-verification.test.ts[2m > [22m[2mBatch Inventory Adjustment Verification (50 Items)
[22m[39mCleanup complete.

 [31m‚ùØ[39m tests/integration/api/adjustments-batch-verification.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 2486[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should create, save, and post an adjustment with 50 items
[90mstdout[2m | tests/integration/api/inventory-adjustment-neg.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:24.618Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/inventory-adjustment-neg.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/inventory-adjustment-neg.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/inventory-adjustment-neg.test.ts[2m > [22m[2mInventory Adjustment Negative Post API
[22m[39m{"level":"error","message":"Prisma error","timestamp":"2025-12-27T03:04:25.457Z","context":{"target":"warehouse.delete","timestamp":"2025-12-27T03:04:25.457Z","message":"\nInvalid `prisma.warehouse.delete()` invocation:\n\n{\n  where: {\n    id: undefined,\n?   AND?: WarehouseWhereInput | WarehouseWhereInput[],\n?   OR?: WarehouseWhereInput[],\n?   NOT?: WarehouseWhereInput | WarehouseWhereInput[],\n?   name?: StringFilter | String,\n?   location?: StringFilter | String,\n?   manager?: StringFilter | String,\n?   maxCapacity?: IntFilter | Int,\n?   branchId?: StringFilter | String,\n?   createdAt?: DateTimeFilter | DateTime,\n?   updatedAt?: DateTimeFilter | DateTime,\n?   Inventory?: InventoryListRelationFilter,\n?   InventoryAdjustment?: InventoryAdjustmentListRelationFilter,\n?   PurchaseOrder?: PurchaseOrderListRelationFilter,\n?   ReceivingVoucher?: ReceivingVoucherListRelationFilter,\n?   SalesOrder?: SalesOrderListRelationFilter,\n?   StockMovement?: StockMovementListRelationFilter,\n?   Branch?: BranchScalarRelationFilter | BranchWhereInput\n  }\n}\n\nArgument `where` of type WarehouseWhereUniqueInput needs at least one of `id` arguments. Available options are marked with ?."}}

 [31m‚ùØ[39m tests/integration/api/inventory-adjustment-neg.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 821[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should allow negative adjustment (stock reduction)
[90mstdout[2m | tests/integration/api/inventory-adjustment-post.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:26.557Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/inventory-adjustment-post.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/inventory-adjustment-post.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/inventory-adjustment-post.test.ts[2m > [22m[2mInventory Adjustment Post API
[22m[39m{"level":"error","message":"Prisma error","timestamp":"2025-12-27T03:04:27.425Z","context":{"target":"warehouse.delete","timestamp":"2025-12-27T03:04:27.425Z","message":"\nInvalid `prisma.warehouse.delete()` invocation:\n\n{\n  where: {\n    id: undefined,\n?   AND?: WarehouseWhereInput | WarehouseWhereInput[],\n?   OR?: WarehouseWhereInput[],\n?   NOT?: WarehouseWhereInput | WarehouseWhereInput[],\n?   name?: StringFilter | String,\n?   location?: StringFilter | String,\n?   manager?: StringFilter | String,\n?   maxCapacity?: IntFilter | Int,\n?   branchId?: StringFilter | String,\n?   createdAt?: DateTimeFilter | DateTime,\n?   updatedAt?: DateTimeFilter | DateTime,\n?   Inventory?: InventoryListRelationFilter,\n?   InventoryAdjustment?: InventoryAdjustmentListRelationFilter,\n?   PurchaseOrder?: PurchaseOrderListRelationFilter,\n?   ReceivingVoucher?: ReceivingVoucherListRelationFilter,\n?   SalesOrder?: SalesOrderListRelationFilter,\n?   StockMovement?: StockMovementListRelationFilter,\n?   Branch?: BranchScalarRelationFilter | BranchWhereInput\n  }\n}\n\nArgument `where` of type WarehouseWhereUniqueInput needs at least one of `id` arguments. Available options are marked with ?."}}

 [31m‚ùØ[39m tests/integration/api/inventory-adjustment-post.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 848[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should create and then successfully POST an adjustment
[90mstdout[2m | tests/integration/api/repro-inventory-post.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:28.389Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/repro-inventory-post.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/repro-inventory-post.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/repro-inventory-post.test.ts[2m > [22m[2mInventory Post 500 Error Reproduction
[22m[39mSetup: Creating test user...

[90mstdout[2m | tests/integration/api/repro-inventory-post.test.ts[2m > [22m[2mInventory Post 500 Error Reproduction
[22m[39mTest data created. User: test-3e5fb6e2-1aaa-4b77-936a-984acc8c256b@example.com
Attempting to login to http://localhost:3001 

[90mstderr[2m | tests/integration/api/repro-inventory-post.test.ts[2m > [22m[2mInventory Post 500 Error Reproduction
[22m[39mSetup failed: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/api/repro-inventory-post.test.ts:29:30 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/api/repro-inventory-post.test.ts:29:36
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/repro-inventory-post.test.ts [2m([22m[2m3 tests[22m[2m | [22m[33m3 skipped[39m[2m)[22m[33m 1628[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should successfully post an inventory adjustment
     [2m[90m‚Üì[39m[22m should handle potential error triggers (e.g., missing alternate UOM)
     [2m[90m‚Üì[39m[22m should handle negative stock scenario if valid
[90mstdout[2m | tests/integration/api/auth.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:30.931Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/auth.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/auth.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/auth.test.ts [2m([22m[2m2 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[33m 1235[2mms[22m[39m
[31m     [31m√ó[31m invalid login returns 401[39m[32m 2[2mms[22m[39m
[31m     [31m√ó[31m valid login returns 200 and me returns 200 with cookie[39m[32m 1[2mms[22m[39m
[90mstdout[2m | tests/integration/api/ar-payments-report.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:33.107Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/ar-payments-report.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/ar-payments-report.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/ar-payments-report.test.ts [2m([22m[2m11 tests[22m[2m | [22m[33m11 skipped[39m[2m)[22m[33m 1004[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should return all payments without filters
     [2m[90m‚Üì[39m[22m should filter payments by date range
     [2m[90m‚Üì[39m[22m should filter payments by payment method
     [2m[90m‚Üì[39m[22m should filter payments by reference number
     [2m[90m‚Üì[39m[22m should filter payments by customer name
     [2m[90m‚Üì[39m[22m should filter payments by branch
     [2m[90m‚Üì[39m[22m should return correct summary statistics
     [2m[90m‚Üì[39m[22m should group payments by payment method correctly
     [2m[90m‚Üì[39m[22m should return 401 for unauthenticated requests
     [2m[90m‚Üì[39m[22m should handle empty results gracefully
     [2m[90m‚Üì[39m[22m should combine multiple filters correctly
[90mstdout[2m | tests/integration/api/fund-sources.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:34.434Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/fund-sources.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîÑ add secrets lifecycle management: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/fund-sources.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/fund-sources.test.ts [2m([22m[2m35 tests[22m[2m | [22m[33m35 skipped[39m[2m)[22m[33m 1102[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create a cash register fund source successfully
       [2m[90m‚Üì[39m[22m should create a bank account fund source with bank details
       [2m[90m‚Üì[39m[22m should create company-wide fund source without branch
       [2m[90m‚Üì[39m[22m should set default fund source
       [2m[90m‚Üì[39m[22m should reject duplicate code
       [2m[90m‚Üì[39m[22m should validate required fields
       [2m[90m‚Üì[39m[22m should fetch all fund sources
       [2m[90m‚Üì[39m[22m should filter by type
       [2m[90m‚Üì[39m[22m should filter by branch
       [2m[90m‚Üì[39m[22m should filter by status
       [2m[90m‚Üì[39m[22m should search by name
       [2m[90m‚Üì[39m[22m should fetch fund source by ID
       [2m[90m‚Üì[39m[22m should return 404 for non-existent fund source
       [2m[90m‚Üì[39m[22m should update fund source details
       [2m[90m‚Üì[39m[22m should update status to inactive
       [2m[90m‚Üì[39m[22m should record a deposit
       [2m[90m‚Üì[39m[22m should record a withdrawal
       [2m[90m‚Üì[39m[22m should reject withdrawal exceeding balance
       [2m[90m‚Üì[39m[22m should validate transaction type
       [2m[90m‚Üì[39m[22m should fetch transaction history
       [2m[90m‚Üì[39m[22m should filter transactions by type
       [2m[90m‚Üì[39m[22m should support pagination
       [2m[90m‚Üì[39m[22m should adjust balance for reconciliation
       [2m[90m‚Üì[39m[22m should require reason for adjustment
       [2m[90m‚Üì[39m[22m should transfer funds between sources
       [2m[90m‚Üì[39m[22m should handle transfer with fee
       [2m[90m‚Üì[39m[22m should reject transfer exceeding balance
       [2m[90m‚Üì[39m[22m should reject transfer to same fund source
       [2m[90m‚Üì[39m[22m should fetch all transfers
       [2m[90m‚Üì[39m[22m should filter by source fund
       [2m[90m‚Üì[39m[22m should filter by destination fund
       [2m[90m‚Üì[39m[22m should fetch dashboard summary
       [2m[90m‚Üì[39m[22m should filter summary by branch
       [2m[90m‚Üì[39m[22m should soft delete fund source with transactions
       [2m[90m‚Üì[39m[22m should hard delete fund source without transactions
[90mstdout[2m | tests/integration/api/sales-orders.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:36.477Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/sales-orders.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/sales-orders.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstderr[2m | tests/integration/api/sales-orders.test.ts[2m > [22m[2mSales Orders API Integration Tests
[22m[39mSetup failed TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at createAndLoginUser (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:171:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/api/sales-orders.test.ts:20:26 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at createAndLoginUser (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:171:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/api/sales-orders.test.ts:20:26 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/sales-orders.test.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 977[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create a new sales order
       [2m[90m‚Üì[39m[22m should return 400 for invalid SO data
       [2m[90m‚Üì[39m[22m should return list of sales orders
       [2m[90m‚Üì[39m[22m should return a sales order by ID
       [2m[90m‚Üì[39m[22m should update sales order
       [2m[90m‚Üì[39m[22m should cancel sales order
[90mstdout[2m | tests/integration/api/ap.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:37.781Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/ap.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/ap.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/ap.test.ts [2m([22m[2m16 tests[22m[2m | [22m[33m16 skipped[39m[2m)[22m[33m 1037[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create AP record successfully
       [2m[90m‚Üì[39m[22m should create AP record with all discount and charge fields
       [2m[90m‚Üì[39m[22m should validate required fields
       [2m[90m‚Üì[39m[22m should record full payment and update status to paid
       [2m[90m‚Üì[39m[22m should record partial payment and update status to partial
       [2m[90m‚Üì[39m[22m should handle multiple partial payments
       [2m[90m‚Üì[39m[22m should reject payment exceeding balance
       [2m[90m‚Üì[39m[22m should reject zero or negative payment
       [2m[90m‚Üì[39m[22m should validate required payment fields
       [2m[90m‚Üì[39m[22m should handle different payment methods
       [2m[90m‚Üì[39m[22m should calculate aging buckets correctly
       [2m[90m‚Üì[39m[22m should calculate total outstanding correctly
       [2m[90m‚Üì[39m[22m should fetch all AP records
       [2m[90m‚Üì[39m[22m should filter by status
       [2m[90m‚Üì[39m[22m should filter by branch
       [2m[90m‚Üì[39m[22m should filter by supplier
[90mstdout[2m | tests/integration/api/adjustments-stress.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:39.727Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/adjustments-stress.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/adjustments-stress.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/adjustments-stress.test.ts[2m > [22m[2mLarge Scale Inventory Adjustment API
[22m[39mCleaning up...

 [31m‚ùØ[39m tests/integration/api/adjustments-stress.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 1172[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should successfully create and retrieve an adjustment with 100 items
[90mstdout[2m | tests/integration/api/adjustments-large-batch.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:41.826Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/adjustments-large-batch.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/adjustments-large-batch.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/adjustments-large-batch.test.ts[2m > [22m[2mFifty Items Inventory Adjustment Verification
[22m[39mCleaning up...

 [31m‚ùØ[39m tests/integration/api/adjustments-large-batch.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 1095[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should successfully create and retrieve an adjustment with exactly 50 items
[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:43.241Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/reproduce_rv_avg_cost.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39müîç Starting Reproduction Test for RV Average Cost Anomaly...

1Ô∏è‚É£ Setting up test data...

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   Created Product: Test Product 8cff5875 (Base: pcs, Alt: box=10pcs)

2Ô∏è‚É£ Scenario 1: First Receipt (1 box @ 100)

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   RV Created: RV-20251227-0004
   Average Cost: 10
   Expected: 10

3Ô∏è‚É£ Scenario 2: Second Receipt (1 box @ 200)

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   RV Created: RV-20251227-0005
   Average Cost: 15
   Expected: 15

4Ô∏è‚É£ Scenario 3: Third Receipt (1 box @ 100 with 20 discount)

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   RV Created: RV-20251227-0006
   Average Cost: 12.66666666666667
   Expected: 12.67

üßπ Cleaning up...

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m{"level":"error","message":"Prisma error","timestamp":"2025-12-27T03:04:55.861Z","context":{"target":"supplier.delete","timestamp":"2025-12-27T03:04:55.861Z","message":"\nInvalid `prisma.supplier.delete()` invocation in\nC:/Users/HI/Documents/GitHub/buenasv2/tests/integration/reproduce_rv_avg_cost.test.ts:238:53\n\n  235     await prisma.productUOM.deleteMany({ where: { productId: product.id } });\n  236     await prisma.product.delete({ where: { id: product.id } });\n  237 }\n‚Üí 238 if (supplier) await prisma.supplier.delete(\nForeign key constraint violated on the constraint: `AccountsPayable_supplierId_fkey`"}}

[90mstderr[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39mCleanup failed PrismaClientKnownRequestError: 
Invalid `prisma.supplier.delete()` invocation in
C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/reproduce_rv_avg_cost.test.ts:238:53

  235     await prisma.productUOM.deleteMany({ where: { productId: product.id } });
  236     await prisma.product.delete({ where: { id: product.id } });
  237 }
‚Üí 238 if (supplier) await prisma.supplier.delete(
Foreign key constraint violated on the constraint: `AccountsPayable_supplierId_fkey`
    at qr.handleRequestError [90m(C:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:65:8172[90m)[39m
    at qr.handleAndLogRequestError [90m(C:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:65:7467[90m)[39m
    at qr.request [90m(C:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:65:7174[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at a [90m(C:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:75:5816[90m)[39m
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/reproduce_rv_avg_cost.test.ts:238:31
    at [90mfile:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:915:20 {
  code: [32m'P2003'[39m,
  meta: {
    modelName: [32m'Supplier'[39m,
    driverAdapterError: DriverAdapterError: ForeignKeyConstraintViolation
        at PrismaPgAdapter.onError [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4m@prisma/adapter-pg[24m/dist/index.mjs:657:11[90m)[39m
        at PrismaPgAdapter.performIO [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4m@prisma/adapter-pg[24m/dist/index.mjs:652:12[90m)[39m
    [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
        at PrismaPgAdapter.queryRaw [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4m@prisma/adapter-pg[24m/dist/index.mjs:572:30[90m)[39m
        at [90mC:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:24163
        at fr [90m(C:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:24002[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:42384[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:42808[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:41603[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\buenasv2\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:43982[90m)[39m {
      cause: [36m[Object][39m
    }
  },
  clientVersion: [32m'7.1.0'[39m
}

 [32m‚úì[39m tests/integration/reproduce_rv_avg_cost.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 11770[2mms[22m[39m
     [33m[2m‚úì[22m[39m should calculate weighted average cost correctly across multiple receipts [33m 10799[2mms[22m[39m
[90mstdout[2m | tests/integration/api/pos.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:56.792Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/pos.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/pos.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/pos.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 876[2mms[22m[39m
     [2m[90m‚Üì[39m[22m processes a cash sale
     [2m[90m‚Üì[39m[22m deducts inventory correctly after sale
[90mstdout[2m | tests/integration/api/purchase-orders.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:58.594Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/purchase-orders.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/purchase-orders.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstderr[2m | tests/integration/api/purchase-orders.test.ts[2m > [22m[2mPurchase Orders API Integration Tests
[22m[39mSetup failed TypeError: Failed to parse URL from http://localhost:3001 /api/dev/seed
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/api/purchase-orders.test.ts:33:23 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/integration/api/purchase-orders.test.ts:33:29
      at [90mfile:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1240:20
      at new Promise (<anonymous>)
      at runWithTimeout [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:1206:10[90m)[39m {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/dev/seed'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/purchase-orders.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 897[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create a new purchase order
       [2m[90m‚Üì[39m[22m should return 400 for invalid PO data
       [2m[90m‚Üì[39m[22m should return list of purchase orders
       [2m[90m‚Üì[39m[22m should filter purchase orders by status
       [2m[90m‚Üì[39m[22m should return a purchase order by ID
       [2m[90m‚Üì[39m[22m should return 404 for non-existent PO
       [2m[90m‚Üì[39m[22m should update purchase order
       [2m[90m‚Üì[39m[22m should cancel purchase order
[90mstdout[2m | tests/integration/api/products.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:04:59.830Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/products.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/products.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/products.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 893[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create a new product
       [2m[90m‚Üì[39m[22m should return 400 for invalid product data
       [2m[90m‚Üì[39m[22m should return list of products
       [2m[90m‚Üì[39m[22m should filter products by category
       [2m[90m‚Üì[39m[22m should return a product by ID
       [2m[90m‚Üì[39m[22m should return 404 for non-existent product
       [2m[90m‚Üì[39m[22m should update product details
       [2m[90m‚Üì[39m[22m should delete (or deactivate) product
[90mstdout[2m | tests/integration/api/roles.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:01.674Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/roles.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/roles.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/roles.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[33m 885[2mms[22m[39m
     [2m[90m‚Üì[39m[22m GET /api/roles - should return list of roles
     [2m[90m‚Üì[39m[22m POST /api/roles - should create a new role
     [2m[90m‚Üì[39m[22m POST /api/roles - should fail with duplicate name
     [2m[90m‚Üì[39m[22m PUT /api/roles/[id] - should update role
     [2m[90m‚Üì[39m[22m DELETE /api/roles/[id] - should delete role
[90mstdout[2m | tests/integration/api/products-uom.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:03.511Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/products-uom.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: üì° add observability to secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/products-uom.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/products-uom.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 758[2mms[22m[39m
     [2m[90m‚Üì[39m[22m updates product alternate UOMs
[90mstdout[2m | tests/integration/api/warehouses.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üóÇÔ∏è backup and recover secrets: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:05.220Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/warehouses.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/warehouses.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/warehouses.test.ts [2m([22m[2m1 test[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 921[2mms[22m[39m
     [2m[90m‚Üì[39m[22m lists warehouses
[90mstdout[2m | tests/integration/api/customers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:07.146Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/customers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  suppress all logs with { quiet: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/customers.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/customers.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m8 skipped[39m[2m)[22m[33m 903[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should create a new customer
       [2m[90m‚Üì[39m[22m should create a new customer with empty email
       [2m[90m‚Üì[39m[22m should return 400 for missing required fields
       [2m[90m‚Üì[39m[22m should return list of customers
       [2m[90m‚Üì[39m[22m should filter customers by search
       [2m[90m‚Üì[39m[22m should return customer by ID
       [2m[90m‚Üì[39m[22m should update customer details
       [2m[90m‚Üì[39m[22m should delete (or deactivate) customer
[90mstdout[2m | tests/integration/api/inventory.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:08.982Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/inventory.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/inventory.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/inventory.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 975[2mms[22m[39m
     [2m[90m‚Üì[39m[22m lists inventory
     [2m[90m‚Üì[39m[22m stock levels endpoint
[90mstdout[2m | tests/integration/api/api-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üîê prevent committing .env to code: https://dotenvx.com/precommit
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:10.278Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/api-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/api-regression.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [32m‚úì[39m tests/integration/api/api-regression.test.ts [2m([22m[2m7 tests[22m[2m)[22m[33m 4473[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return PO with correct Prisma relation names (capital letters) [33m 728[2mms[22m[39m
       [33m[2m‚úì[22m[39m should list POs with correct property names [33m 613[2mms[22m[39m
       [33m[2m‚úì[22m[39m should return RV with correct Prisma relation names [33m 1063[2mms[22m[39m
[90mstdout[2m | tests/integration/api/customer-search.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:15.683Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/customer-search.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/customer-search.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/customer-search.test.ts [2m([22m[2m5 tests[22m[2m | [22m[33m5 skipped[39m[2m)[22m[33m 878[2mms[22m[39m
     [2m[90m‚Üì[39m[22m should find customer by single keyword "UniqueName"
     [2m[90m‚Üì[39m[22m should find customer by exact phrase "SearchTest One"
     [2m[90m‚Üì[39m[22m should find customer by partial multi-keyword "Alpha One"
     [2m[90m‚Üì[39m[22m should find customer by mixed case keywords "uniqueNAME beta"
     [2m[90m‚Üì[39m[22m should NOT find customer if one keyword matches and another does not "Alpha Gamma"
[90mstdout[2m | tests/integration/api/uom-traceability-e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:17.510Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/uom-traceability-e2e.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üîë add access controls to secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/uom-traceability-e2e.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/uom-traceability-e2e.test.ts[2m > [22m[2mEnd-to-End UOM Traceability Test[2m > [22m[2mshould track UOM correctly for both Adjustments and POS Sales
[22m[39m[CompanySettingsService] Attempting to find existing settings...

[90mstdout[2m | tests/integration/api/uom-traceability-e2e.test.ts[2m > [22m[2mEnd-to-End UOM Traceability Test[2m > [22m[2mshould track UOM correctly for both Adjustments and POS Sales
[22m[39m[CompanySettingsService] Found settings: YES

[90mstdout[2m | tests/integration/api/uom-traceability-e2e.test.ts[2m > [22m[2mEnd-to-End UOM Traceability Test[2m > [22m[2mshould track UOM correctly for both Adjustments and POS Sales
[22m[39mSuccessfully verified UOM traceability for Adjustment (TEST-ADJ-1766804718884) and POS Sale (TEST-RCP-1766804719377)

 [32m‚úì[39m tests/integration/api/uom-traceability-e2e.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 3257[2mms[22m[39m
     [33m[2m‚úì[22m[39m should track UOM correctly for both Adjustments and POS Sales [33m 2203[2mms[22m[39m
[90mstdout[2m | tests/integration/api/inventory-adjustments.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:21.903Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/inventory-adjustments.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/inventory-adjustments.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [31m‚ùØ[39m tests/integration/api/inventory-adjustments.test.ts [2m([22m[2m2 tests[22m[2m | [22m[33m2 skipped[39m[2m)[22m[33m 1009[2mms[22m[39m
       [2m[90m‚Üì[39m[22m should return 401 without auth token
       [2m[90m‚Üì[39m[22m should return list of adjustments with auth
[90mstdout[2m | tests/integration/auth-forms.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:23.814Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/auth-forms.test.tsx
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üë• sync secrets across teammates & machines: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/auth-forms.test.tsx
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Cannot read properties of undefined (reading 'text')
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:145:31)
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9

 [32m‚úì[39m tests/integration/auth-forms.test.tsx [2m([22m[2m8 tests[22m[2m)[22m[33m 2161[2mms[22m[39m
     [33m[2m‚úì[22m[39m submits form with email and shows success state [33m 365[2mms[22m[39m
     [33m[2m‚úì[22m[39m shows error message on API failure [33m 427[2mms[22m[39m
     [33m[2m‚úì[22m[39m shows generic error on network failure [33m 334[2mms[22m[39m
[90mstdout[2m | tests/integration/api/diagnostic-adjustments.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  write to custom object with { processEnv: myObject }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:27.272Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/diagnostic-adjustments.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üîê prevent building .env in docker: https://dotenvx.com/prebuild
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/diagnostic-adjustments.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/diagnostic-adjustments.test.ts[2m > [22m[2mDiagnostic: List Adjustments[2m > [22m[2mshould list draft and recently posted adjustments
[22m[39mDiagnostic results written to diagnostic-results.json

 [32m‚úì[39m tests/integration/api/diagnostic-adjustments.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1614[2mms[22m[39m
     [33m[2m‚úì[22m[39m should list draft and recently posted adjustments [33m 726[2mms[22m[39m
[90mstdout[2m | tests/integration/api/verify-movements.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:29.789Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/verify-movements.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  enable debug logging with { debug: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/verify-movements.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/verify-movements.test.ts[2m > [22m[2mVerification: Stock Movements for Posted Adjustment[2m > [22m[2mshould have correct uom and factor in stock movements
[22m[39mVerified 63 movements.

 [32m‚úì[39m tests/integration/api/verify-movements.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1169[2mms[22m[39m
[90mstdout[2m | tests/integration/api/inspect-draft.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: üì° add observability to secrets: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:31.876Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/inspect-draft.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: ‚öôÔ∏è  override existing env vars with { override: true }
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  specify custom .env file path with { path: '/custom/path/.env' }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/inspect-draft.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

 [32m‚úì[39m tests/integration/api/inspect-draft.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 1127[2mms[22m[39m
[90mstdout[2m | tests/integration/api/post-all.test.ts
[22m[39m[dotenv@17.2.3] injecting env (20) from .env.local -- tip: ‚úÖ audit secrets and track compliance: https://dotenvx.com/ops
{"level":"info","message":"Initializing Prisma","timestamp":"2025-12-27T03:05:33.934Z","context":{"databaseHost":"ep-spring-pond-a1stve3k-pooler.ap-southeast-1.aws.neon.tech"}}

[90mstdout[2m | tests/integration/api/post-all.test.ts
[22m[39m[dotenv@17.2.3] injecting env (0) from .env.local -- tip: üîê encrypt with Dotenvx: https://dotenvx.com
[dotenv@17.2.3] injecting env (0) from .env -- tip: ‚öôÔ∏è  load multiple .env files with { path: ['.env.local', '.env'] }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/post-all.test.ts
[22m[39mTest auth initialization failed, tests may need to handle auth independently: TypeError: Failed to parse URL from http://localhost:3001 /api/auth/login
[90m    at node:internal/deps/undici/undici:15845:13[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:20)
    at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:23)
    at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
  [cause]: TypeError: Invalid URL
  [90m    at new URL (node:internal/url:828:25)[39m
      at new URL$1 [90m(file:///C:/Users/HI/Documents/GitHub/buenasv2/[39mnode_modules/[4mvitest[24m/dist/chunks/index.BspFP3mn.js:556:9[90m)[39m
  [90m    at new Request (node:internal/deps/undici/undici:10413:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:11325:25)[39m
  [90m    at fetch (node:internal/deps/undici/undici:15843:10)[39m
  [90m    at fetch (node:internal/bootstrap/web/exposed-window-or-worker:83:12)[39m
      at Module.loginUserViaApi (C:/Users/HI/Documents/GitHub/buenasv2/tests/helpers/test-db-utils.ts:140:26)
      at initTestAuth (C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:46:29)
  [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
      at C:/Users/HI/Documents/GitHub/buenasv2/tests/setup.ts:74:9 {
    code: [32m'ERR_INVALID_URL'[39m,
    input: [32m'http://localhost:3001 /api/auth/login'[39m
  }
}

[90mstdout[2m | tests/integration/api/post-all.test.ts[2m > [22m[2mExecution: Post All Draft Adjustments[2m > [22m[2mshould post all draft adjustments
[22m[39mFound 0 draft adjustments to post.
Posting results written to posting-results.json

 [32m‚úì[39m tests/integration/api/post-all.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 929[2mms[22m[39m

[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Suites 27 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m tests/integration/api/adjustments-batch-verification.test.ts[2m > [22mBatch Inventory Adjustment Verification (50 Items)
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/adjustments-batch-verification.test.ts:[2m40:30[22m[39m
    [90m 38| [39m
    [90m 39| [39m            [90m// Login[39m
    [90m 40| [39m            const loginRes = await fetch(`${BASE_URL}/api/auth/login`,‚Ä¶
    [90m   | [39m                             [31m^[39m
    [90m 41| [39m                method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 42| [39m                headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/adjustments-batch-verification.test.ts:[2m40:36[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[1/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/adjustments-large-batch.test.ts[2m > [22mFifty Items Inventory Adjustment Verification
[31m[1mTypeError[22m: fetch failed[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:20[22m[39m
    [90m138| [39m[90m// Function to log in a user via the API[39m
    [90m139| [39mexport async function loginUserViaApi(credentials: any, baseUrl: strin‚Ä¶
    [90m140| [39m  [35mconst[39m response [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39mbaseUrl[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                   [31m^[39m
    [90m141| [39m    method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m142| [39m    headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m
[90m [2m‚ùØ[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m171:23[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/adjustments-large-batch.test.ts:[2m18:26[22m[39m

{
  stack: 'AggregateError: \n' +
    '    at internalConnectMultiple (node:net:1134:18)\n' +
    '    at afterConnectMultiple (node:net:1715:7)',
  errors: [
    {
      stack: 'Error: connect ECONNREFUSED ::1:3000\n' +
        '    at createConnectionError (node:net:1678:14)\n' +
        '    at afterConnectMultiple (node:net:1708:16)',
      message: 'connect ECONNREFUSED ::1:3000',
      errno: -4078,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '::1',
      port: 3000,
      constructor: 'Function<Error>',
      name: 'Error',
      toString: 'Function<toString>'
    },
    {
      stack: 'Error: connect ECONNREFUSED 127.0.0.1:3000\n' +
        '    at createConnectionError (node:net:1678:14)\n' +
        '    at afterConnectMultiple (node:net:1708:16)',
      message: 'connect ECONNREFUSED 127.0.0.1:3000',
      errno: -4078,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 3000,
      constructor: 'Function<Error>',
      name: 'Error',
      toString: 'Function<toString>'
    }
  ],
  code: 'ECONNREFUSED',
  constructor: 'Function<AggregateError>',
  name: 'Caused by: AggregateError',
  message: '',
  toString: 'Function<toString>',
  stacks: []
}
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errors: [ { stack: 'Error: connect ECONNREFUSED ::1:3000\n    at createConnectionError (node:net:1678:14)\n    at afterConnectMultiple (node:net:1708:16)', message: 'connect ECONNREFUSED ::1:3000', errno: -4078, code: 'ECONNREFUSED', syscall: 'connect', address: '::1', port: 3000, constructor: 'Function<Error>', name: 'Error', toString: 'Function<toString>' }, { stack: 'Error: connect ECONNREFUSED 127.0.0.1:3000\n    at createConnectionError (node:net:1678:14)\n    at afterConnectMultiple (node:net:1708:16)', message: 'connect ECONNREFUSED 127.0.0.1:3000', errno: -4078, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 3000, constructor: 'Function<Error>', name: 'Error', toString: 'Function<toString>' } ], code: 'ECONNREFUSED' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[2/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/adjustments-stress.test.ts[2m > [22mLarge Scale Inventory Adjustment API
[31m[1mTypeError[22m: fetch failed[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:20[22m[39m
    [90m138| [39m[90m// Function to log in a user via the API[39m
    [90m139| [39mexport async function loginUserViaApi(credentials: any, baseUrl: strin‚Ä¶
    [90m140| [39m  [35mconst[39m response [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39mbaseUrl[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                   [31m^[39m
    [90m141| [39m    method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m142| [39m    headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m
[90m [2m‚ùØ[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m171:23[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/adjustments-stress.test.ts:[2m18:26[22m[39m

{
  stack: 'AggregateError: \n' +
    '    at internalConnectMultiple (node:net:1134:18)\n' +
    '    at afterConnectMultiple (node:net:1715:7)',
  errors: [
    {
      stack: 'Error: connect ECONNREFUSED ::1:3000\n' +
        '    at createConnectionError (node:net:1678:14)\n' +
        '    at afterConnectMultiple (node:net:1708:16)',
      message: 'connect ECONNREFUSED ::1:3000',
      errno: -4078,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '::1',
      port: 3000,
      constructor: 'Function<Error>',
      name: 'Error',
      toString: 'Function<toString>'
    },
    {
      stack: 'Error: connect ECONNREFUSED 127.0.0.1:3000\n' +
        '    at createConnectionError (node:net:1678:14)\n' +
        '    at afterConnectMultiple (node:net:1708:16)',
      message: 'connect ECONNREFUSED 127.0.0.1:3000',
      errno: -4078,
      code: 'ECONNREFUSED',
      syscall: 'connect',
      address: '127.0.0.1',
      port: 3000,
      constructor: 'Function<Error>',
      name: 'Error',
      toString: 'Function<toString>'
    }
  ],
  code: 'ECONNREFUSED',
  constructor: 'Function<AggregateError>',
  name: 'Caused by: AggregateError',
  message: '',
  toString: 'Function<toString>',
  stacks: []
}
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ errors: [ { stack: 'Error: connect ECONNREFUSED ::1:3000\n    at createConnectionError (node:net:1678:14)\n    at afterConnectMultiple (node:net:1708:16)', message: 'connect ECONNREFUSED ::1:3000', errno: -4078, code: 'ECONNREFUSED', syscall: 'connect', address: '::1', port: 3000, constructor: 'Function<Error>', name: 'Error', toString: 'Function<toString>' }, { stack: 'Error: connect ECONNREFUSED 127.0.0.1:3000\n    at createConnectionError (node:net:1678:14)\n    at afterConnectMultiple (node:net:1708:16)', message: 'connect ECONNREFUSED 127.0.0.1:3000', errno: -4078, code: 'ECONNREFUSED', syscall: 'connect', address: '127.0.0.1', port: 3000, constructor: 'Function<Error>', name: 'Error', toString: 'Function<toString>' } ], code: 'ECONNREFUSED' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[3/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/adjustments.test.ts[2m > [22mAdjustments API Routes
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/adjustments.test.ts:[2m65:31[22m[39m
    [90m 63| [39m
    [90m 64| [39m        [90m// Get auth token and userId[39m
    [90m 65| [39m        const loginResponse = await fetch(`${BASE_URL}/api/auth/login`‚Ä¶
    [90m   | [39m                              [31m^[39m
    [90m 66| [39m            method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 67| [39m            headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/adjustments.test.ts:[2m65:37[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[4/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ap.test.ts[2m > [22mAccounts Payable API Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:20[22m[39m
    [90m138| [39m[90m// Function to log in a user via the API[39m
    [90m139| [39mexport async function loginUserViaApi(credentials: any, baseUrl: strin‚Ä¶
    [90m140| [39m  [35mconst[39m response [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39mbaseUrl[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                   [31m^[39m
    [90m141| [39m    method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m142| [39m    headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m
[90m [2m‚ùØ[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m171:23[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/ap.test.ts:[2m28:81[22m[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:26[22m[39m
[90m [2m‚ùØ[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m171:29[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/ap.test.ts:[2m28:81[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[5/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ap.test.ts[2m > [22mAccounts Payable API Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/api/ap.test.ts:[2m52:77[22m[39m
    [90m 50| [39m    // The individual test cleanups (afterEach) might handle most AP r‚Ä¶
    [90m 51| [39m    [90m// Ensure any remaining AP records for testBranch are cleaned up.[39m
    [90m 52| [39m    await prisma.accountsPayable.deleteMany({ where: { branchId: testB‚Ä¶
    [90m   | [39m                                                                            [31m^[39m
    [90m 53| [39m    [35mawait[39m prisma[33m.[39msupplier[33m.[39m[35mdelete[39m({ where[33m:[39m { id[33m:[39m testSupplier[33m.[39mid } })[33m;[39m
    [90m 54| [39m    [35mawait[39m prisma[33m.[39mbranch[33m.[39m[35mdelete[39m({ where[33m:[39m { id[33m:[39m testBranch[33m.[39mid } })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[6/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ar-payments-report.test.ts[2m > [22mAR Payments Report API
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:20[22m[39m
    [90m138| [39m[90m// Function to log in a user via the API[39m
    [90m139| [39mexport async function loginUserViaApi(credentials: any, baseUrl: strin‚Ä¶
    [90m140| [39m  [35mconst[39m response [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39mbaseUrl[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                   [31m^[39m
    [90m141| [39m    method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m142| [39m    headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m
[90m [2m‚ùØ[22m createAuthHeaders tests/helpers/test-db-utils.ts:[2m190:18[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/ar-payments-report.test.ts:[2m28:23[22m[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:26[22m[39m
[90m [2m‚ùØ[22m createAuthHeaders tests/helpers/test-db-utils.ts:[2m190:24[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/ar-payments-report.test.ts:[2m28:29[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[7/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ar.test.ts[2m > [22mAccounts Receivable API Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/ar.test.ts:[2m19:21[22m[39m
    [90m 17| [39m  [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 18| [39m    [90m// Seed database[39m
    [90m 19| [39m    [35mconst[39m seedRes [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39m[33mBASE_URL[39m[36m}[39m[32m/api/dev/seed`[39m[33m,[39m {
    [90m   | [39m                    [31m^[39m
    [90m 20| [39m      method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 21| [39m      headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/ar.test.ts:[2m19:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[8/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ar.test.ts[2m > [22mAccounts Receivable API Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/api/ar.test.ts:[2m75:80[22m[39m
    [90m 73| [39m  [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m 74| [39m    [90m// Cleanup[39m
    [90m 75| [39m    await prisma.accountsReceivable.deleteMany({ where: { branchId: te‚Ä¶
    [90m   | [39m                                                                               [31m^[39m
    [90m 76| [39m    [35mawait[39m prisma[33m.[39mcustomer[33m.[39m[35mdelete[39m({ where[33m:[39m { id[33m:[39m testCustomer[33m.[39mid } })[33m;[39m
    [90m 77| [39m    [35mawait[39m prisma[33m.[39mbranch[33m.[39m[35mdelete[39m({ where[33m:[39m { id[33m:[39m testBranch[33m.[39mid } })[33m;[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[9/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/customer-search.test.ts[2m > [22mCustomer Search Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/customer-search.test.ts:[2m13:26[22m[39m
    [90m 11| [39m    [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 12| [39m        [90m// Login[39m
    [90m 13| [39m        [35mconst[39m loginRes [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39m[33mBASE_URL[39m[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                         [31m^[39m
    [90m 14| [39m            method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 15| [39m            headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/customer-search.test.ts:[2m13:32[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[10/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/customers.test.ts[2m > [22mCustomers API Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/customers.test.ts:[2m27:26[22m[39m
    [90m 25| [39m
    [90m 26| [39m        [90m// 1. Login[39m
    [90m 27| [39m        [35mconst[39m loginRes [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39m[33mBASE_URL[39m[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                         [31m^[39m
    [90m 28| [39m            method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 29| [39m            headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/customers.test.ts:[2m27:32[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[11/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/data-maintenance.test.ts[2m > [22mData Maintenance API Support (Product Categories)
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/data-maintenance.test.ts:[2m14:25[22m[39m
    [90m 12| [39m    [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 13| [39m        [90m// 1. Seed data[39m
    [90m 14| [39m        const seedRes = await fetch(`${BASE_URL}/api/dev/seed`, { meth‚Ä¶
    [90m   | [39m                        [31m^[39m
    [90m 15| [39m        [35mconst[39m seed [33m=[39m [35mawait[39m seedRes[33m.[39m[34mjson[39m()
    [90m 16| [39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/data-maintenance.test.ts:[2m14:31[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[12/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/fund-sources.test.ts[2m > [22mFund Sources API Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:20[22m[39m
    [90m138| [39m[90m// Function to log in a user via the API[39m
    [90m139| [39mexport async function loginUserViaApi(credentials: any, baseUrl: strin‚Ä¶
    [90m140| [39m  [35mconst[39m response [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39mbaseUrl[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                   [31m^[39m
    [90m141| [39m    method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m142| [39m    headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m
[90m [2m‚ùØ[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m171:23[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/fund-sources.test.ts:[2m24:85[22m[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:26[22m[39m
[90m [2m‚ùØ[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m171:29[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/fund-sources.test.ts:[2m24:85[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[13/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/inventory-adjustment-neg.test.ts[2m > [22mInventory Adjustment Negative Post API
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/inventory-adjustment-neg.test.ts:[2m17:31[22m[39m
    [90m 15| [39m    [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 16| [39m        [90m// Login[39m
    [90m 17| [39m        const loginResponse = await fetch(`${BASE_URL}/api/auth/login`‚Ä¶
    [90m   | [39m                              [31m^[39m
    [90m 18| [39m            method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 19| [39m            headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/inventory-adjustment-neg.test.ts:[2m17:37[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[14/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/inventory-adjustment-post.test.ts[2m > [22mInventory Adjustment Post API
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/inventory-adjustment-post.test.ts:[2m18:31[22m[39m
    [90m 16| [39m    [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 17| [39m        [90m// Login to get token and user ID[39m
    [90m 18| [39m        const loginResponse = await fetch(`${BASE_URL}/api/auth/login`‚Ä¶
    [90m   | [39m                              [31m^[39m
    [90m 19| [39m            method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 20| [39m            headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/inventory-adjustment-post.test.ts:[2m18:37[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[15/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/inventory-adjustments.test.ts[2m > [22mInventory Adjustments API Routes
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/inventory-adjustments.test.ts:[2m47:31[22m[39m
    [90m 45| [39m
    [90m 46| [39m        [90m// Login[39m
    [90m 47| [39m        const loginResponse = await fetch(`${BASE_URL}/api/auth/login`‚Ä¶
    [90m   | [39m                              [31m^[39m
    [90m 48| [39m            method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 49| [39m            headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/inventory-adjustments.test.ts:[2m47:37[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[16/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/inventory.test.ts[2m > [22mInventory API
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/inventory.test.ts:[2m10:21[22m[39m
    [90m  8| [39m  [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m  9| [39m    [90m// 1. Seed data[39m
    [90m 10| [39m    const seedRes = await fetch(`${BASE_URL}/api/dev/seed`, { method: ‚Ä¶
    [90m   | [39m                    [31m^[39m
    [90m 11| [39m    [35mconst[39m seed [33m=[39m [35mawait[39m seedRes[33m.[39m[34mjson[39m()
    [90m 12| [39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/inventory.test.ts:[2m10:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[17/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/pos.test.ts[2m > [22mPOS Sales API
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/pos.test.ts:[2m30:21[22m[39m
    [90m 28| [39m
    [90m 29| [39m    [90m// 1. Seed data[39m
    [90m 30| [39m    const seedRes = await fetch(`${BASE_URL}/api/dev/seed`, { method: ‚Ä¶
    [90m   | [39m                    [31m^[39m
    [90m 31| [39m    [35mconst[39m seed [33m=[39m [35mawait[39m seedRes[33m.[39m[34mjson[39m()
    [90m 32| [39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/pos.test.ts:[2m30:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[18/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/products-uom.test.ts[2m > [22mProducts UOM
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/products-uom.test.ts:[2m11:21[22m[39m
    [90m  9| [39m  [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 10| [39m    [90m// 1. Seed data[39m
    [90m 11| [39m    const seedRes = await fetch(`${BASE_URL}/api/dev/seed`, { method: ‚Ä¶
    [90m   | [39m                    [31m^[39m
    [90m 12| [39m    [35mconst[39m seed [33m=[39m [35mawait[39m seedRes[33m.[39m[34mjson[39m()
    [90m 13| [39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/products-uom.test.ts:[2m11:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[19/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/products.test.ts[2m > [22mProducts API Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/products.test.ts:[2m14:21[22m[39m
    [90m 12| [39m  [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 13| [39m    [90m// 1. Seed data[39m
    [90m 14| [39m    const seedRes = await fetch(`${BASE_URL}/api/dev/seed`, { method: ‚Ä¶
    [90m   | [39m                    [31m^[39m
    [90m 15| [39m    [35mconst[39m seed [33m=[39m [35mawait[39m seedRes[33m.[39m[34mjson[39m()
    [90m 16| [39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/products.test.ts:[2m14:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[20/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/purchase-orders.test.ts[2m > [22mPurchase Orders API Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/purchase-orders.test.ts:[2m33:23[22m[39m
    [90m 31| [39m    [35mtry[39m {
    [90m 32| [39m      [90m// 1. Seed data[39m
    [90m 33| [39m      const seedRes = await fetch(`${BASE_URL}/api/dev/seed`, { method‚Ä¶
    [90m   | [39m                      [31m^[39m
    [90m 34| [39m      [35mconst[39m seed [33m=[39m [35mawait[39m seedRes[33m.[39m[34mjson[39m()
    [90m 35| [39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/purchase-orders.test.ts:[2m33:29[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[21/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-list.test.ts[2m > [22mReceiving Voucher List Integrity Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/receiving-voucher-list.test.ts:[2m20:25[22m[39m
    [90m 18| [39m    [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 19| [39m        [90m// 1. Seed data[39m
    [90m 20| [39m        [35mconst[39m seedRes [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39m[33mBASE_URL[39m[36m}[39m[32m/api/dev/seed`[39m[33m,[39m {
    [90m   | [39m                        [31m^[39m
    [90m 21| [39m            method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 22| [39m            headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/receiving-voucher-list.test.ts:[2m20:31[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22mReceiving Voucher Transaction Integrity Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/receiving-voucher-transaction.test.ts:[2m25:25[22m[39m
    [90m 23| [39m        const BASE_URL = process.env.BASE_URL || 'http://127.0.0.1:300‚Ä¶
    [90m 24| [39m        console[33m.[39m[34mlog[39m([32m'Transaction Test BASE_URL:'[39m[33m,[39m [33mBASE_URL[39m)[33m;[39m
    [90m 25| [39m        [35mconst[39m seedRes [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39m[33mBASE_URL[39m[36m}[39m[32m/api/dev/seed`[39m[33m,[39m {
    [90m   | [39m                        [31m^[39m
    [90m 26| [39m            method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 27| [39m            headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/receiving-voucher-transaction.test.ts:[2m25:31[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[23/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22mReceiving Voucher Transaction Integrity Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/api/receiving-voucher-transaction.test.ts:[2m152:85[22m[39m
    [90m150| [39m
    [90m151| [39m    [34mafterAll[39m([35masync[39m () [33m=>[39m {
    [90m152| [39m        await prisma.accountsPayable.deleteMany({ where: { supplierId:‚Ä¶
    [90m   | [39m                                                                                    [31m^[39m
    [90m153| [39m        [90m// PO and Product are cleaned up in afterEach[39m
    [90m154| [39m        await prisma.supplier.delete({ where: { id: testSupplier.id } ‚Ä¶

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[24/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-uom.test.ts[2m > [22mReceiving Voucher UOM Conversion Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/receiving-voucher-uom.test.ts:[2m22:21[22m[39m
    [90m 20| [39m    [90m// 1. Seed data (roles, admin user)[39m
    [90m 21| [39m    console[33m.[39m[34mlog[39m([32m'Test BASE_URL:'[39m[33m,[39m [33mBASE_URL[39m)[33m;[39m
    [90m 22| [39m    const seedRes = await fetch(`${BASE_URL}/api/dev/seed`, { method: ‚Ä¶
    [90m   | [39m                    [31m^[39m
    [90m 23| [39m    [35mconst[39m seed [33m=[39m [35mawait[39m seedRes[33m.[39m[34mjson[39m()
    [90m 24| [39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/receiving-voucher-uom.test.ts:[2m22:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[25/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-uom.test.ts[2m > [22mReceiving Voucher UOM Conversion Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2m‚ùØ[22m tests/integration/api/receiving-voucher-uom.test.ts:[2m172:71[22m[39m
    [90m170| [39m    [90m// Clean up all test data[39m
    [90m171| [39m    [35mawait[39m prisma[33m.[39mreceivingVoucherItem[33m.[39m[34mdeleteMany[39m({
    [90m172| [39m      where: { ReceivingVoucher: { purchaseOrderId: testPurchaseOrder.‚Ä¶
    [90m   | [39m                                                                      [31m^[39m
    [90m173| [39m    })[33m;[39m
    [90m174| [39m    [35mawait[39m prisma[33m.[39mreceivingVoucher[33m.[39m[34mdeleteMany[39m({

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[26/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/registration.test.ts[2m > [22mRegistration API Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/registration.test.ts:[2m12:5[22m[39m
    [90m 10| [39m  [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 11| [39m    [90m// Seed database to ensure required roles exist[39m
    [90m 12| [39m    [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39m[33mBASE_URL[39m[36m}[39m[32m/api/dev/seed`[39m[33m,[39m { method[33m:[39m [32m'POST'[39m })[33m;[39m
    [90m   | [39m    [31m^[39m
    [90m 13| [39m    [90m// Get Cashier role ID for tests[39m
    [90m 14| [39m    [35mconst[39m cashierRole [33m=[39m [35mawait[39m prisma[33m.[39mrole[33m.[39m[34mfindFirst[39m({

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/registration.test.ts:[2m12:11[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[27/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/repro-inventory-post.test.ts[2m > [22mInventory Post 500 Error Reproduction
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/repro-inventory-post.test.ts:[2m29:30[22m[39m
    [90m 27| [39m            console[33m.[39m[34mlog[39m([32m'Attempting to login to'[39m[33m,[39m [33mBASE_URL[39m)[33m;[39m
    [90m 28| [39m            [90m// Login with the created user[39m
    [90m 29| [39m            const loginRes = await fetch(`${BASE_URL}/api/auth/login`,‚Ä¶
    [90m   | [39m                             [31m^[39m
    [90m 30| [39m                method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 31| [39m                headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/repro-inventory-post.test.ts:[2m29:36[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[28/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/roles.test.ts[2m > [22mRoles API
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/roles.test.ts:[2m13:26[22m[39m
    [90m 11| [39m    [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m 12| [39m        [90m// Login to get auth token[39m
    [90m 13| [39m        [35mconst[39m response [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39m[33mBASE_URL[39m[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                         [31m^[39m
    [90m 14| [39m            method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 15| [39m            headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/roles.test.ts:[2m13:32[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[29/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/sales-orders.test.ts[2m > [22mSales Orders API Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:20[22m[39m
    [90m138| [39m[90m// Function to log in a user via the API[39m
    [90m139| [39mexport async function loginUserViaApi(credentials: any, baseUrl: strin‚Ä¶
    [90m140| [39m  [35mconst[39m response [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39mbaseUrl[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                   [31m^[39m
    [90m141| [39m    method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m142| [39m    headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m
[90m [2m‚ùØ[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m171:23[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/sales-orders.test.ts:[2m20:26[22m[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m140:26[22m[39m
[90m [2m‚ùØ[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m171:29[22m[39m
[90m [2m‚ùØ[22m tests/integration/api/sales-orders.test.ts:[2m20:26[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[30/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/warehouses.test.ts[2m > [22mWarehouses API
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/dev/seed[39m
[36m [2m‚ùØ[22m tests/integration/api/warehouses.test.ts:[2m10:21[22m[39m
    [90m  8| [39m  [34mbeforeAll[39m([35masync[39m () [33m=>[39m {
    [90m  9| [39m    [90m// 1. Seed data[39m
    [90m 10| [39m    const seedRes = await fetch(`${BASE_URL}/api/dev/seed`, { method: ‚Ä¶
    [90m   | [39m                    [31m^[39m
    [90m 11| [39m    [35mconst[39m seed [33m=[39m [35mawait[39m seedRes[33m.[39m[34mjson[39m()
    [90m 12| [39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/warehouses.test.ts:[2m10:27[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/dev/seed' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[31/33]‚éØ[22m[39m


[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m[1m[41m Failed Tests 2 [49m[22m[31m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[39m

[41m[1m FAIL [22m[49m tests/integration/api/auth.test.ts[2m > [22mAuth API[2m > [22minvalid login returns 401
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/auth.test.ts:[2m39:15[22m[39m
    [90m 37| [39m
    [90m 38| [39m  [34mit[39m([32m'invalid login returns 401'[39m[33m,[39m [35masync[39m () [33m=>[39m {
    [90m 39| [39m    [35mconst[39m r [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39m[33mBASE_URL[39m[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m              [31m^[39m
    [90m 40| [39m      method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 41| [39m      headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/auth.test.ts:[2m39:21[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[32/33]‚éØ[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/auth.test.ts[2m > [22mAuth API[2m > [22mvalid login returns 200 and me returns 200 with cookie
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3001 /api/auth/login[39m
[36m [2m‚ùØ[22m tests/integration/api/auth.test.ts:[2m51:19[22m[39m
    [90m 49| [39m  it('valid login returns 200 and me returns 200 with cookie', async (‚Ä¶
    [90m 50| [39m    [90m// Log in with the dynamically created test user[39m
    [90m 51| [39m    [35mconst[39m login [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39m[33mBASE_URL[39m[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                  [31m^[39m
    [90m 52| [39m      method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m 53| [39m      headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2m‚ùØ[22m tests/integration/api/auth.test.ts:[2m51:25[22m[39m

[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3001 /api/auth/login' }[39m
[31m[2m‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ‚éØ[33/33]‚éØ[22m[39m


[2m Test Files [22m [1m[31m28 failed[39m[22m[2m | [22m[1m[32m8 passed[39m[22m[90m (36)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m21 passed[39m[22m[2m | [22m[33m170 skipped[39m[90m (193)[39m
[2m   Start at [22m 11:04:09
[2m   Duration [22m 85.54s[2m (transform 733ms, setup 6.36s, import 1.87s, tests 55.32s, environment 16.37s)[22m

error: script "test:integration" exited with code 1
