
> inventory-pro@0.1.0 test:integration
> vitest run tests/integration --fileParallelism=false


[1m[46m RUN [49m[22m [36mv4.0.8 [39m[90mC:/Users/HI/Documents/GitHub/_deve local/_React Apps/test[39m

[90mstdout[2m | tests/integration/api/ap.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/ap.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

 [31mâ¯[39m tests/integration/api/ap.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m[33m 3143[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create AP record successfully
       [2m[90mâ†“[39m[22m should validate required fields
       [2m[90mâ†“[39m[22m should record full payment and update status to paid
       [2m[90mâ†“[39m[22m should record partial payment and update status to partial
       [2m[90mâ†“[39m[22m should handle multiple partial payments
       [2m[90mâ†“[39m[22m should reject payment exceeding balance
       [2m[90mâ†“[39m[22m should reject zero or negative payment
       [2m[90mâ†“[39m[22m should validate required payment fields
       [2m[90mâ†“[39m[22m should handle different payment methods
       [2m[90mâ†“[39m[22m should calculate aging buckets correctly
       [2m[90mâ†“[39m[22m should calculate total outstanding correctly
       [2m[90mâ†“[39m[22m should fetch all AP records
       [2m[90mâ†“[39m[22m should filter by status
       [2m[90mâ†“[39m[22m should filter by branch
       [2m[90mâ†“[39m[22m should filter by supplier
[90mstdout[2m | tests/integration/api/purchase-orders.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
Setup: DATABASE_URL is defined

 [32mâœ“[39m tests/integration/api/purchase-orders.test.ts [2m([22m[2m8 tests[22m[2m | [22m[33m1 skipped[39m[2m)[22m[33m 12368[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create a new purchase order [33m 1500[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return list of purchase orders [33m 345[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return a purchase order by ID [33m 805[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update purchase order [33m 880[2mms[22m[39m
[90mstdout[2m | tests/integration/api/customers.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
Setup: DATABASE_URL is defined

 [32mâœ“[39m tests/integration/api/customers.test.ts [2m([22m[2m7 tests[22m[2m)[22m[33m 3822[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create a new customer [33m 639[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return customer by ID [33m 364[2mms[22m[39m
       [33m[2mâœ“[22m[39m should delete (or deactivate) customer [33m 403[2mms[22m[39m
[90mstdout[2m | tests/integration/api/pos.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  load multiple .env files with { path: ['.env.local', '.env'] }
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/pos.test.ts[2m > [22m[2mPOS Sales API[2m > [22m[2mdeducts inventory correctly after sale
[22m[39mInitial Stock: [33m998[39m

[90mstdout[2m | tests/integration/api/pos.test.ts[2m > [22m[2mPOS Sales API[2m > [22m[2mdeducts inventory correctly after sale
[22m[39mFinal Stock: [33m993[39m

 [32mâœ“[39m tests/integration/api/pos.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 7221[2mms[22m[39m
     [33m[2mâœ“[22m[39m processes a cash sale [33m 1842[2mms[22m[39m
     [33m[2mâœ“[22m[39m deducts inventory correctly after sale [33m 1819[2mms[22m[39m
[90mstdout[2m | tests/integration/api/receiving-voucher-uom.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âœ… audit secrets and track compliance: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/receiving-voucher-uom.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/api/receiving-voucher-uom.test.ts[2m > [22m[2mReceiving Voucher UOM Conversion Integration Tests
[22m[39mTest BASE_URL: http://127.0.0.1:3007

 [32mâœ“[39m tests/integration/api/receiving-voucher-uom.test.ts [2m([22m[2m5 tests[22m[2m)[22m[33m 20018[2mms[22m[39m
       [33m[2mâœ“[22m[39m should successfully create receiving voucher with case to bottle conversion [33m 3614[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle partial case receipt (0.5 case = 5 bottles) [33m 2900[2mms[22m[39m
       [33m[2mâœ“[22m[39m should work with pack UOM conversion [33m 2932[2mms[22m[39m
       [33m[2mâœ“[22m[39m should fail with invalid UOM configuration [33m 2170[2mms[22m[39m
       [33m[2mâœ“[22m[39m should prevent the original UOM conversion bug [33m 2861[2mms[22m[39m
[90mstdout[2m | tests/integration/api/ar.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ðŸ”‘ add access controls to secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/ar.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

 [32mâœ“[39m tests/integration/api/ar.test.ts [2m([22m[2m14 tests[22m[2m)[22m[33m 15968[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create AR record successfully [33m 918[2mms[22m[39m
       [33m[2mâœ“[22m[39m should record full payment and update status to paid [33m 1364[2mms[22m[39m
       [33m[2mâœ“[22m[39m should record partial payment and update status to partial [33m 1008[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle multiple partial payments [33m 2501[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject payment exceeding balance [33m 614[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject zero or negative payment [33m 581[2mms[22m[39m
       [33m[2mâœ“[22m[39m should validate required payment fields [33m 303[2mms[22m[39m
       [33m[2mâœ“[22m[39m should calculate aging buckets correctly [33m 906[2mms[22m[39m
       [33m[2mâœ“[22m[39m should group by customer correctly [33m 589[2mms[22m[39m
       [33m[2mâœ“[22m[39m should calculate total outstanding correctly [33m 587[2mms[22m[39m
       [33m[2mâœ“[22m[39m should fetch all AR records [33m 892[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter by status [33m 509[2mms[22m[39m
       [33m[2mâœ“[22m[39m should filter by branch [33m 514[2mms[22m[39m
[90mstdout[2m | tests/integration/api/products-uom.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  suppress all logs with { quiet: true }
Setup: DATABASE_URL is defined

 [32mâœ“[39m tests/integration/api/products-uom.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 4275[2mms[22m[39m
     [33m[2mâœ“[22m[39m updates product alternate UOMs [33m 1008[2mms[22m[39m
[90mstdout[2m | tests/integration/api/sales-orders.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  enable debug logging with { debug: true }
Setup: DATABASE_URL is defined

[90mstderr[2m | tests/integration/api/sales-orders.test.ts[2m > [22m[2mSales Orders API Integration Tests
[22m[39mSetup failed SyntaxError: Unexpected token '<', "<!DOCTYPE "... is not valid JSON
    at JSON.parse (<anonymous>)
[90m    at parseJSONFromBytes (node:internal/deps/undici/undici:6433:19)[39m
[90m    at successSteps (node:internal/deps/undici/undici:6414:27)[39m
[90m    at readAllBytes (node:internal/deps/undici/undici:5380:13)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m

 [31mâ¯[39m tests/integration/api/sales-orders.test.ts [2m([22m[2m6 tests[22m[2m | [22m[33m6 skipped[39m[2m)[22m[33m 5118[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create a new sales order
       [2m[90mâ†“[39m[22m should return 400 for invalid SO data
       [2m[90mâ†“[39m[22m should return list of sales orders
       [2m[90mâ†“[39m[22m should return a sales order by ID
       [2m[90mâ†“[39m[22m should update sales order
       [2m[90mâ†“[39m[22m should cancel sales order
[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests
[22m[39mTransaction Test BASE_URL: http://127.0.0.1:3007

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests
[22m[39mLogging in...

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests
[22m[39mLogin Status: [33m200[39m

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests
[22m[39mLogin successful, token obtained
Creating test user...

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests
[22m[39mCreating test branch...

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests
[22m[39mCreating test warehouse...

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests
[22m[39mCreating test supplier...

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests
[22m[39mTest data created

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests[2m > [22m[2mTransaction Atomicity[2m > [22m[2mshould create RV, update inventory, and record stock movement in single transaction
[22m[39mbeforeEach: Creating Product and PO

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests[2m > [22m[2mTransaction Atomicity[2m > [22m[2mshould rollback all changes if any operation fails
[22m[39mbeforeEach: Creating Product and PO

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests[2m > [22m[2mTransaction Atomicity[2m > [22m[2mshould handle multiple items in single transaction
[22m[39mbeforeEach: Creating Product and PO

[90mstdout[2m | tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22m[2mReceiving Voucher Transaction Integrity Tests[2m > [22m[2mRegression: Nested Transaction Bug[2m > [22m[2mshould not throw 500 error due to nested transactions
[22m[39mbeforeEach: Creating Product and PO

 [31mâ¯[39m tests/integration/api/receiving-voucher-transaction.test.ts [2m([22m[2m4 tests[22m[2m | [22m[31m1 failed[39m[2m)[22m[33m 14847[2mms[22m[39m
[31m       [31mÃ—[31m should create RV, update inventory, and record stock movement in single transaction[39m[33m 1101[2mms[22m[39m
       [33m[2mâœ“[22m[39m should rollback all changes if any operation fails [33m 1836[2mms[22m[39m
       [33m[2mâœ“[22m[39m should handle multiple items in single transaction [33m 4306[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not throw 500 error due to nested transactions [33m 2938[2mms[22m[39m
[90mstdout[2m | tests/integration/api/registration.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ðŸ” encrypt with Dotenvx: https://dotenvx.com
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/registration.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

 [32mâœ“[39m tests/integration/api/registration.test.ts [2m([22m[2m10 tests[22m[2m)[22m[33m 10867[2mms[22m[39m
       [33m[2mâœ“[22m[39m should successfully register a new user with valid data [33m 1412[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject registration with duplicate email [33m 1285[2mms[22m[39m
       [33m[2mâœ“[22m[39m should reject registration with invalid role ID [33m 734[2mms[22m[39m
       [33m[2mâœ“[22m[39m should hash password before storing in database [33m 1088[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create audit log entry for registration [33m 1236[2mms[22m[39m
       [33m[2mâœ“[22m[39m should not include updatedAt field in user creation (regression test) [33m 1067[2mms[22m[39m
       [33m[2mâœ“[22m[39m should work with correct Cashier role ID (regression test) [33m 995[2mms[22m[39m
[90mstdout[2m | tests/integration/api/products.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ðŸ” prevent committing .env to code: https://dotenvx.com/precommit
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/products.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

 [32mâœ“[39m tests/integration/api/products.test.ts [2m([22m[2m8 tests[22m[2m)[22m[33m 6849[2mms[22m[39m
       [33m[2mâœ“[22m[39m should create a new product [33m 672[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return 404 for non-existent product [33m 307[2mms[22m[39m
       [33m[2mâœ“[22m[39m should update product details [33m 669[2mms[22m[39m
       [33m[2mâœ“[22m[39m should delete (or deactivate) product [33m 1175[2mms[22m[39m
[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ðŸ”„ add secrets lifecycle management: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39mðŸ” Starting Reproduction Test for RV Average Cost Anomaly...

1ï¸âƒ£ Setting up test data...

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   Created Product: Test Product 93e96d11 (Base: pcs, Alt: box=10pcs)

2ï¸âƒ£ Scenario 1: First Receipt (1 box @ 100)

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   RV Created: RV-20251201-0028
   Average Cost: 10
   Expected: 10

3ï¸âƒ£ Scenario 2: Second Receipt (1 box @ 200)

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   RV Created: RV-20251201-0029
   Average Cost: 15
   Expected: 15

4ï¸âƒ£ Scenario 3: Third Receipt (1 box @ 100 with 20 discount)

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m   RV Created: RV-20251201-0030
   Average Cost: 12.66666666666667
   Expected: 12.67

ðŸ§¹ Cleaning up...

[90mstdout[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39m{"level":"error","message":"Prisma error","timestamp":"2025-12-01T02:21:43.939Z","context":{"target":"supplier.delete","timestamp":"2025-12-01T02:21:43.939Z","message":"\nInvalid `prisma.supplier.delete()` invocation in\nC:/Users/HI/Documents/GitHub/_deve local/_React Apps/test/tests/integration/reproduce_rv_avg_cost.test.ts:238:53\n\n  235     await prisma.productUOM.deleteMany({ where: { productId: product.id } });\n  236     await prisma.product.delete({ where: { id: product.id } });\n  237 }\nâ†’ 238 if (supplier) await prisma.supplier.delete(\nForeign key constraint violated on the constraint: `AccountsPayable_supplierId_fkey`"}}

[90mstderr[2m | tests/integration/reproduce_rv_avg_cost.test.ts[2m > [22m[2mReceiving Voucher Average Cost Anomaly Reproduction[2m > [22m[2mshould calculate weighted average cost correctly across multiple receipts
[22m[39mCleanup failed PrismaClientKnownRequestError: 
Invalid `prisma.supplier.delete()` invocation in
C:/Users/HI/Documents/GitHub/_deve local/_React Apps/test/tests/integration/reproduce_rv_avg_cost.test.ts:238:53

  235     await prisma.productUOM.deleteMany({ where: { productId: product.id } });
  236     await prisma.product.delete({ where: { id: product.id } });
  237 }
â†’ 238 if (supplier) await prisma.supplier.delete(
Foreign key constraint violated on the constraint: `AccountsPayable_supplierId_fkey`
    at $r.handleRequestError [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:65:7347[90m)[39m
    at $r.handleAndLogRequestError [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:65:6642[90m)[39m
    at $r.request [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:65:6349[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
    at a [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:75:5816[90m)[39m
    at C:/Users/HI/Documents/GitHub/_deve local/_React Apps/test/tests/integration/reproduce_rv_avg_cost.test.ts:238:31
    at [90mfile:///C:/Users/HI/Documents/GitHub/_deve%20local/_React%20Apps/test/[39mnode_modules/[4m@vitest/runner[24m/dist/index.js:753:20 {
  code: [32m'P2003'[39m,
  meta: {
    modelName: [32m'Supplier'[39m,
    driverAdapterError: DriverAdapterError: ForeignKeyConstraintViolation
        at PrismaPgAdapter.onError [90m(file:///C:/Users/HI/Documents/GitHub/_deve%20local/_React%20Apps/test/[39mnode_modules/[4m@prisma/adapter-pg[24m/dist/index.mjs:657:11[90m)[39m
        at PrismaPgAdapter.performIO [90m(file:///C:/Users/HI/Documents/GitHub/_deve%20local/_React%20Apps/test/[39mnode_modules/[4m@prisma/adapter-pg[24m/dist/index.mjs:652:12[90m)[39m
    [90m    at processTicksAndRejections (node:internal/process/task_queues:105:5)[39m
        at PrismaPgAdapter.queryRaw [90m(file:///C:/Users/HI/Documents/GitHub/_deve%20local/_React%20Apps/test/[39mnode_modules/[4m@prisma/adapter-pg[24m/dist/index.mjs:572:30[90m)[39m
        at [90mC:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:23732
        at mr [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:23571[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:41866[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:42290[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:41116[90m)[39m
        at e.interpretNode [90m(C:\Users\HI\Documents\GitHub\_deve local\_React Apps\test\[39mnode_modules\[4m@prisma\client[24m\runtime\client.js:11:43464[90m)[39m {
      cause: [36m[Object][39m
    }
  },
  clientVersion: [32m'7.0.0'[39m
}

 [32mâœ“[39m tests/integration/reproduce_rv_avg_cost.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 9480[2mms[22m[39m
     [33m[2mâœ“[22m[39m should calculate weighted average cost correctly across multiple receipts [33m 9478[2mms[22m[39m
[90mstdout[2m | tests/integration/api/warehouses.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  override existing env vars with { override: true }
Setup: DATABASE_URL is defined

 [32mâœ“[39m tests/integration/api/warehouses.test.ts [2m([22m[2m1 test[22m[2m)[22m[33m 4873[2mms[22m[39m
     [33m[2mâœ“[22m[39m lists warehouses [33m 1131[2mms[22m[39m
[90mstdout[2m | tests/integration/api/inventory.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ðŸ—‚ï¸ backup and recover secrets: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

 [32mâœ“[39m tests/integration/api/inventory.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 3813[2mms[22m[39m
     [33m[2mâœ“[22m[39m lists inventory [33m 326[2mms[22m[39m
     [33m[2mâœ“[22m[39m stock levels endpoint [33m 401[2mms[22m[39m
[90mstdout[2m | tests/integration/api/api-regression.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ðŸ” prevent building .env in docker: https://dotenvx.com/prebuild
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/api-regression.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

 [32mâœ“[39m tests/integration/api/api-regression.test.ts [2m([22m[2m7 tests[22m[2m)[22m[33m 4141[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return PO with correct Prisma relation names (capital letters) [33m 676[2mms[22m[39m
       [33m[2mâœ“[22m[39m should list POs with correct property names [33m 635[2mms[22m[39m
       [33m[2mâœ“[22m[39m should return RV with correct Prisma relation names [33m 1137[2mms[22m[39m
[90mstdout[2m | tests/integration/api/auth.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: âš™ï¸  specify custom .env file path with { path: '/custom/path/.env' }
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/auth.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

[90mstdout[2m | tests/integration/api/auth.test.ts
[22m[39mAuth Test BASE_URL: http://127.0.0.1:3007

 [32mâœ“[39m tests/integration/api/auth.test.ts [2m([22m[2m2 tests[22m[2m)[22m[33m 3215[2mms[22m[39m
     [33m[2mâœ“[22m[39m valid login returns 200 and me returns 200 with cookie [33m 2171[2mms[22m[39m

[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Suites 2 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m tests/integration/api/ap.test.ts[2m > [22mAccounts Payable API Integration Tests
[41m[1m FAIL [22m[49m tests/integration/api/sales-orders.test.ts[2m > [22mSales Orders API Integration Tests
[31m[1mSyntaxError[22m: Unexpected token '<', "<!DOCTYPE "... is not valid JSON[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[1/4]âŽ¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ap.test.ts[2m > [22mAccounts Payable API Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2mâ¯[22m tests/integration/api/ap.test.ts:[2m52:77[22m[39m
    [90m 50| [39m    // The individual test cleanups (afterEach) might handle most AP râ€¦
    [90m 51| [39m    [90m// Ensure any remaining AP records for testBranch are cleaned up.[39m
    [90m 52| [39m    await prisma.accountsPayable.deleteMany({ where: { branchId: testBâ€¦
    [90m   | [39m                                                                            [31m^[39m
    [90m 53| [39m    [35mawait[39m prisma[33m.[39msupplier[33m.[39m[35mdelete[39m({ where[33m:[39m { id[33m:[39m testSupplier[33m.[39mid } })[33m;[39m
    [90m 54| [39m    [35mawait[39m prisma[33m.[39mbranch[33m.[39m[35mdelete[39m({ where[33m:[39m { id[33m:[39m testBranch[33m.[39mid } })[33m;[39m

[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[2/4]âŽ¯[22m[39m


[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m[1m[41m Failed Tests 1 [49m[22m[31mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[39m

[41m[1m FAIL [22m[49m tests/integration/api/receiving-voucher-transaction.test.ts[2m > [22mReceiving Voucher Transaction Integrity Tests[2m > [22mTransaction Atomicity[2m > [22mshould create RV, update inventory, and record stock movement in single transaction
[31m[1mSyntaxError[22m: Unexpected token '<', "<!DOCTYPE "... is not valid JSON[39m
[31m[2mâŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯âŽ¯[3/4]âŽ¯[22m[39m


[2m Test Files [22m [1m[31m3 failed[39m[22m[2m | [22m[1m[32m13 passed[39m[22m[90m (16)[39m
[2m      Tests [22m [1m[31m1 failed[39m[22m[2m | [22m[1m[32m70 passed[39m[22m[2m | [22m[33m22 skipped[39m[90m (93)[39m
[2m   Start at [22m 10:19:38
[2m   Duration [22m 143.79s[2m (transform 414ms, setup 2.05s, collect 2.11s, tests 130.02s, environment 6.76s, prepare 244ms)[22m

