
[1m[46m RUN [49m[22m [36mv4.0.8 [39m[90mC:/Users/HI/Documents/GitHub/_deve local/_React Apps/test[39m

[90mstdout[2m | tests/integration/api/ap.test.ts
[22m[39m[dotenv@17.2.3] injecting env (16) from .env -- tip: ğŸ‘¥ sync secrets across teammates & machines: https://dotenvx.com/ops
Setup: DATABASE_URL is defined

[90mstdout[2m | tests/integration/api/ap.test.ts
[22m[39mInitializing Prisma with DATABASE_URL: postgresql://neondb_...

 [31mâ¯[39m tests/integration/api/ap.test.ts [2m([22m[2m15 tests[22m[2m | [22m[33m15 skipped[39m[2m)[22m[33m 924[2mms[22m[39m
       [2m[90mâ†“[39m[22m should create AP record successfully
       [2m[90mâ†“[39m[22m should validate required fields
       [2m[90mâ†“[39m[22m should record full payment and update status to paid
       [2m[90mâ†“[39m[22m should record partial payment and update status to partial
       [2m[90mâ†“[39m[22m should handle multiple partial payments
       [2m[90mâ†“[39m[22m should reject payment exceeding balance
       [2m[90mâ†“[39m[22m should reject zero or negative payment
       [2m[90mâ†“[39m[22m should validate required payment fields
       [2m[90mâ†“[39m[22m should handle different payment methods
       [2m[90mâ†“[39m[22m should calculate aging buckets correctly
       [2m[90mâ†“[39m[22m should calculate total outstanding correctly
       [2m[90mâ†“[39m[22m should fetch all AP records
       [2m[90mâ†“[39m[22m should filter by status
       [2m[90mâ†“[39m[22m should filter by branch
       [2m[90mâ†“[39m[22m should filter by supplier

[31mâ¯â¯â¯â¯â¯â¯[39m[1m[41m Failed Suites 1 [49m[22m[31mâ¯â¯â¯â¯â¯â¯â¯[39m

[41m[1m FAIL [22m[49m tests/integration/api/ap.test.ts[2m > [22mAccounts Payable API Integration Tests
[31m[1mTypeError[22m: Failed to parse URL from http://localhost:3007 /api/auth/login[39m
[36m [2mâ¯[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m115:20[22m[39m
    [90m113| [39m[90m// Function to log in a user via the API[39m
    [90m114| [39mexport async function loginUserViaApi(credentials: any, baseUrl: strinâ€¦
    [90m115| [39m  [35mconst[39m response [33m=[39m [35mawait[39m [34mfetch[39m([32m`[39m[36m${[39mbaseUrl[36m}[39m[32m/api/auth/login`[39m[33m,[39m {
    [90m   | [39m                   [31m^[39m
    [90m116| [39m    method[33m:[39m [32m'POST'[39m[33m,[39m
    [90m117| [39m    headers[33m:[39m { [32m'Content-Type'[39m[33m:[39m [32m'application/json'[39m }[33m,[39m
[90m [2mâ¯[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m138:23[22m[39m
[90m [2mâ¯[22m tests/integration/api/ap.test.ts:[2m28:81[22m[39m

[31m[1mCaused by: TypeError[22m: Invalid URL[39m
[36m [2mâ¯[22m loginUserViaApi tests/helpers/test-db-utils.ts:[2m115:26[22m[39m
[90m [2mâ¯[22m createAndLoginUser tests/helpers/test-db-utils.ts:[2m138:29[22m[39m
[90m [2mâ¯[22m tests/integration/api/ap.test.ts:[2m28:81[22m[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[22m[39m
[31m[1mSerialized Error:[22m[39m [90m{ code: 'ERR_INVALID_URL', input: 'http://localhost:3007 /api/auth/login' }[39m
[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/2]â¯[22m[39m

[41m[1m FAIL [22m[49m tests/integration/api/ap.test.ts[2m > [22mAccounts Payable API Integration Tests
[31m[1mTypeError[22m: Cannot read properties of undefined (reading 'id')[39m
[36m [2mâ¯[22m tests/integration/api/ap.test.ts:[2m52:77[22m[39m
    [90m 50| [39m    // The individual test cleanups (afterEach) might handle most AP râ€¦
    [90m 51| [39m    [90m// Ensure any remaining AP records for testBranch are cleaned up.[39m
    [90m 52| [39m    await prisma.accountsPayable.deleteMany({ where: { branchId: testBâ€¦
    [90m   | [39m                                                                            [31m^[39m
    [90m 53| [39m    [35mawait[39m prisma[33m.[39msupplier[33m.[39m[35mdelete[39m({ where[33m:[39m { id[33m:[39m testSupplier[33m.[39mid } })[33m;[39m
    [90m 54| [39m    [35mawait[39m prisma[33m.[39mbranch[33m.[39m[35mdelete[39m({ where[33m:[39m { id[33m:[39m testBranch[33m.[39mid } })[33m;[39m

[31m[2mâ¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/2]â¯[22m[39m


[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [33m15 skipped[39m[90m (15)[39m
[2m   Start at [22m 03:22:58
[2m   Duration [22m 1.81s[2m (transform 85ms, setup 150ms, collect 138ms, tests 924ms, environment 0ms, prepare 13ms)[22m

